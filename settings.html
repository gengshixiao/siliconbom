<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººè®¾ç½® - SiliconBom ç¡…å®</title>
    <style>
        :root {
            --bg-color: #F8FAFC;
            --trace-active: #6DD5E8;
            --text-main: #334155;
            --text-secondary: #64748B;
            --border-color: #E2E8F0;
            --primary-color: #6DD5E8;
            --primary-hover: #4DB6AC;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'PingFang SC', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(#E2E8F0 1px, transparent 1px);
            background-size: 30px 30px;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* é®ç½©å±‚ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* å¼¹çª—å®¹å™¨ */
        .settings-modal {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 900px;
            height: 90vh;
            max-height: 700px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1001;
        }

        /* å¼¹çª—å¤´éƒ¨ */
        .modal-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-title-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            object-fit: cover;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background-color 0.2s ease;
            font-size: 20px;
            color: var(--text-secondary);
        }

        .close-btn:hover {
            background-color: #F1F5F9;
        }

        /* å¼¹çª—ä¸»ä½“ - å·¦å³åˆ†æ  */
        .modal-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* å·¦ä¾§èœå• */
        .settings-menu {
            width: 240px;
            background: #FAFBFC;
            border-right: 1px solid var(--border-color);
            padding: 16px 12px;
            overflow-y: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .menu-item:hover {
            background-color: #F1F5F9;
        }

        .menu-item.active {
            background-color: #E0F7FA;
            color: var(--trace-active);
            font-weight: 500;
        }

        .menu-item-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        /* å³ä¾§å†…å®¹ */
        .settings-content {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 24px;
        }

        .content-placeholder {
            padding: 40px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* è¡¨å•æ ·å¼ */
        .password-form {
            max-width: 500px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-main);
            margin-bottom: 8px;
        }

        .form-label-required {
            color: #EF4444;
            margin-left: 4px;
        }

        .input-wrapper {
            position: relative;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: #fff;
            color: var(--text-main);
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--trace-active);
            box-shadow: 0 0 0 3px rgba(109, 213, 232, 0.1);
        }

        .form-input::placeholder {
            color: #94A3B8;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 18px;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease;
        }

        .password-toggle:hover {
            color: var(--text-main);
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 6px;
            line-height: 1.5;
        }

        .form-hint.error {
            color: #EF4444;
        }

        /* ä¸ªäººèµ„æ–™æ ·å¼ */
        .profile-form {
            max-width: 500px;
        }

        .avatar-section {
            display: flex;
            justify-content: center;
            margin-bottom: 32px;
        }

        .avatar-upload {
            position: relative;
            width: 100px;
            height: 100px;
            cursor: pointer;
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .avatar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: #fff;
            font-size: 12px;
        }

        .avatar-upload:hover .avatar-overlay {
            opacity: 1;
        }

        .avatar-overlay-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .avatar-upload input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .char-counter {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: var(--text-secondary);
            pointer-events: none;
        }

        .form-input[readonly] {
            background: #F8FAFC;
            cursor: not-allowed;
            color: #94A3B8;
        }

        /* ç ”å‘åå¥½æ ·å¼ */
        .preferences-form {
            max-width: 600px;
        }

        .form-section {
            margin-bottom: 32px;
        }

        .form-section-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 12px;
        }

        /* æ ‡ç­¾å®¹å™¨ */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        /* æ ‡ç­¾é¡¹ */
        .preference-tag {
            position: relative;
            padding: 10px 20px;
            border: 1.5px solid var(--border-color);
            border-radius: 24px;
            font-size: 14px;
            color: var(--text-main);
            background: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .preference-tag:hover {
            border-color: var(--trace-active);
            background: #F0FDFF;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(109, 213, 232, 0.15);
        }

        .preference-tag.selected {
            border-color: transparent;
            color: #fff;
        }

        /* ä¸åŒæ¨¡å¼çš„é¢œè‰² */
        .preference-tag[data-mode="balanced"].selected {
            background: linear-gradient(135deg, #6DD5E8 0%, #4DB6AC 100%);
            box-shadow: 0 4px 12px rgba(109, 213, 232, 0.3);
        }

        .preference-tag[data-mode="efficiency"].selected {
            background: linear-gradient(135deg, #F59E0B 0%, #F97316 100%);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .preference-tag[data-mode="inspiration"].selected {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .preference-tag-icon {
            font-size: 16px;
        }

        /* Tooltipæç¤º */
        .preference-tag-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 12px;
            line-height: 1.5;
            max-width: 320px;
            min-width: 240px;
            white-space: normal;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .preference-tag-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.85);
        }

        .preference-tag:hover .preference-tag-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* å¤šè¡Œæ–‡æœ¬è¾“å…¥ */
        .preference-textarea {
            width: 100%;
            min-height: 180px;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-main);
            font-family: inherit;
            resize: vertical;
            transition: all 0.2s ease;
            background: #fff;
            line-height: 1.6;
        }

        .preference-textarea:focus {
            outline: none;
            border-color: var(--trace-active);
            box-shadow: 0 0 0 3px rgba(109, 213, 232, 0.1);
        }

        .preference-textarea::placeholder {
            color: #94A3B8;
            line-height: 1.6;
        }

        /* å¼¹çª—åº•éƒ¨ */
        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: #FAFBFC;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-cancel {
            background: #fff;
            color: var(--text-main);
            border: 1px solid var(--border-color);
        }

        .btn-cancel:hover {
            background: #F8FAFC;
            border-color: #CBD5E1;
        }

        .btn-save {
            background: linear-gradient(135deg, var(--trace-active) 0%, #4DB6AC 100%);
            color: #fff;
        }

        .btn-save:hover {
            background: linear-gradient(135deg, #4DB6AC 0%, var(--trace-active) 100%);
            box-shadow: 0 4px 12px rgba(109, 213, 232, 0.3);
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .settings-menu::-webkit-scrollbar,
        .settings-content::-webkit-scrollbar {
            width: 6px;
        }

        .settings-menu::-webkit-scrollbar-thumb,
        .settings-content::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 3px;
        }

        .settings-menu::-webkit-scrollbar-thumb:hover,
        .settings-content::-webkit-scrollbar-thumb:hover {
            background: #94A3B8;
        }

        .settings-menu::-webkit-scrollbar-track,
        .settings-content::-webkit-scrollbar-track {
            background: transparent;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .settings-modal {
                width: 95%;
                height: 95vh;
            }

            .settings-menu {
                width: 200px;
            }

            .settings-content {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="modal-overlay">
        <div class="settings-modal">
            <!-- å¤´éƒ¨ -->
            <div class="modal-header">
                <h2 class="modal-title">
                    <img src="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/f4f1acead1b2b1cfc74946089e643749.png" alt="ç¡…å®" class="modal-title-icon">
                    <span>ä¸ªäººè®¾ç½®</span>
                </h2>
                <button class="close-btn" id="closeBtn">Ã—</button>
            </div>

            <!-- ä¸»ä½“å†…å®¹ -->
            <div class="modal-body">
                <!-- å·¦ä¾§èœå• -->
                <div class="settings-menu">
                    <div class="menu-item active" data-tab="profile">
                        <svg class="menu-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span>ä¸ªäººèµ„æ–™</span>
                    </div>
                    <div class="menu-item" data-tab="preferences">
                        <svg class="menu-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        <span>ç ”å‘åå¥½</span>
                    </div>
                    <div class="menu-item" data-tab="password">
                        <svg class="menu-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        <span>ä¿®æ”¹å¯†ç </span>
                    </div>
                </div>

                <!-- å³ä¾§å†…å®¹ -->
                <div class="settings-content">
                    <!-- ä¸ªäººèµ„æ–™å†…å®¹ -->
                    <div class="content-section active" id="profile-section">
                        <div class="profile-form">
                            <!-- å¤´åƒä¸Šä¼  -->
                            <div class="avatar-section">
                                <div class="avatar-upload">
                                    <img 
                                        id="avatarPreview" 
                                        src="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/f4f1acead1b2b1cfc74946089e643749.png" 
                                        alt="å¤´åƒ" 
                                        class="avatar-image"
                                    >
                                    <div class="avatar-overlay">
                                        <div class="avatar-overlay-icon">ğŸ“·</div>
                                        <div>æ›´æ¢å¤´åƒ</div>
                                    </div>
                                    <input 
                                        type="file" 
                                        id="avatarInput" 
                                        accept="image/jpeg,image/png,image/jpg,image/gif"
                                    >
                                </div>
                            </div>

                            <!-- åç§° -->
                            <div class="form-group">
                                <label class="form-label">åç§°</label>
                                <div class="input-wrapper">
                                    <input 
                                        type="text" 
                                        class="form-input" 
                                        id="profileName" 
                                        placeholder="è¯·è¾“å…¥åç§°"
                                        value="136****6079"
                                        maxlength="20"
                                    >
                                    <span class="char-counter">
                                        <span id="nameCharCount">11</span> / 20
                                    </span>
                                </div>
                            </div>

                            <!-- æ‰‹æœºå· -->
                            <div class="form-group">
                                <label class="form-label">æ‰‹æœºå·</label>
                                <input 
                                    type="tel" 
                                    class="form-input" 
                                    id="profilePhone" 
                                    value="13645166079"
                                    readonly
                                >
                            </div>
                        </div>
                    </div>

                    <!-- ç ”å‘åå¥½å†…å®¹ -->
                    <div class="content-section" id="preferences-section">
                        <div class="preferences-form">
                            <!-- ç ”å‘é£æ ¼ -->
                            <div class="form-section">
                                <div class="form-section-title">ç ”å‘é£æ ¼</div>
                                <div class="tags-container">
                                    <div class="preference-tag selected" data-mode="balanced">
                                        <span class="preference-tag-icon">âš–ï¸</span>
                                        <span>å‡è¡¡æ¨¡å¼</span>
                                        <div class="preference-tag-tooltip">
                                            åœ¨ä»»åŠ¡æ·±åº¦å’Œæ—¶é—´ä¸Šåšäº†å¹³è¡¡ï¼Œé€‚ç”¨äºå¤§å¤šæ•°å·¥ç¨‹å¸ˆ
                                        </div>
                                    </div>
                                    <div class="preference-tag" data-mode="efficiency">
                                        <span class="preference-tag-icon">âš¡</span>
                                        <span>æ•ˆç‡æ¨¡å¼</span>
                                        <div class="preference-tag-tooltip">
                                            ç¡…å®å°†ä¸“æ³¨äºæ‰§è¡Œä½ å‘å‡ºçš„æŒ‡ä»¤ï¼Œé€Ÿåº¦æœ€å¿«ï¼Œä½†ä¸ä¼šå¸®ä½ æ€è€ƒè¿‡å¤šå†…å®¹
                                        </div>
                                    </div>
                                    <div class="preference-tag" data-mode="inspiration">
                                        <span class="preference-tag-icon">ğŸ’¡</span>
                                        <span>å¯å‘æ¨¡å¼</span>
                                        <div class="preference-tag-tooltip">
                                            ç¡…å®å°†ä½¿ç”¨æ›´å¤æ‚çš„æ¨¡å‹å’Œæ›´å¤šçš„æ•°æ®ä¸ä½ åä½œï¼Œç»“æœæ›´ä¸°å¯Œå’Œå…¨é¢ï¼Œä½†è€—æ—¶æ›´ä¹…
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- é€‰å‹åå¥½ -->
                            <div class="form-section">
                                <div class="form-section-title">é€‰å‹åå¥½</div>
                                <textarea 
                                    class="preference-textarea" 
                                    id="selectionPreference"
                                    placeholder="æè¿°ä½ çš„é€‰å‹å€¾å‘ï¼Œä¾‹å¦‚ï¼š&#10;â€¢ åå¥½çš„å“ç‰Œï¼ˆTIã€ADIã€å›½äº§ç­‰ï¼‰&#10;â€¢ æŠ€æœ¯å‚æ•°è¦æ±‚ï¼ˆåŠŸè€—ã€ç²¾åº¦ã€é€Ÿåº¦ç­‰ï¼‰&#10;â€¢ åº”ç”¨åœºæ™¯ç‰¹ç‚¹ï¼ˆè½¦è§„ã€å·¥ä¸šã€æ¶ˆè´¹çº§ï¼‰&#10;â€¢ å…¶ä»–è€ƒè™‘å› ç´ "
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- ä¿®æ”¹å¯†ç å†…å®¹ -->
                    <div class="content-section" id="password-section">
                        <h3 class="section-title">ä¿®æ”¹å¯†ç </h3>
                        <form class="password-form" id="passwordForm">
                            <div class="form-group">
                                <label class="form-label">
                                    å½“å‰å¯†ç 
                                    <span class="form-label-required">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input 
                                        type="password" 
                                        class="form-input" 
                                        id="currentPassword" 
                                        placeholder="è¯·è¾“å…¥å½“å‰å¯†ç "
                                        required
                                    >
                                    <button class="password-toggle" type="button" data-target="currentPassword">
                                        ğŸ‘
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    æ–°å¯†ç 
                                    <span class="form-label-required">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input 
                                        type="password" 
                                        class="form-input" 
                                        id="newPassword" 
                                        placeholder="8-20ä½,æ•°å­—/å¤§/å°å†™å­—æ¯/å­—ç¬¦è‡³å°‘3ç§"
                                        required
                                    >
                                    <button class="password-toggle" type="button" data-target="newPassword">
                                        ğŸ‘
                                    </button>
                                </div>
                                <div class="form-hint">
                                    å¯†ç é•¿åº¦ä¸º8-20ä½ï¼Œéœ€åŒ…å«æ•°å­—ã€å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ä¸­çš„è‡³å°‘3ç§
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    ç¡®è®¤æ–°å¯†ç 
                                    <span class="form-label-required">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input 
                                        type="password" 
                                        class="form-input" 
                                        id="confirmPassword" 
                                        placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç "
                                        required
                                    >
                                    <button class="password-toggle" type="button" data-target="confirmPassword">
                                        ğŸ‘
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- åº•éƒ¨æŒ‰é’® -->
            <div class="modal-footer">
                <button class="btn btn-cancel" id="cancelBtn">å–æ¶ˆ</button>
                <button class="btn btn-save" id="saveBtn">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const closeBtn = document.getElementById('closeBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveBtn = document.getElementById('saveBtn');
        const menuItems = document.querySelectorAll('.menu-item');
        const contentSections = document.querySelectorAll('.content-section');

        // å¤´åƒä¸Šä¼ åŠŸèƒ½
        const avatarInput = document.getElementById('avatarInput');
        const avatarPreview = document.getElementById('avatarPreview');

        avatarInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // éªŒè¯æ–‡ä»¶ç±»å‹
                const validTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/gif'];
                if (!validTypes.includes(file.type)) {
                    alert('åªæ”¯æŒ JPGã€PNGã€GIF æ ¼å¼çš„å›¾ç‰‡');
                    return;
                }

                // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º5MBï¼‰
                const maxSize = 5 * 1024 * 1024;
                if (file.size > maxSize) {
                    alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB');
                    return;
                }

                // è¯»å–å¹¶é¢„è§ˆå›¾ç‰‡
                const reader = new FileReader();
                reader.onload = function(event) {
                    avatarPreview.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // åç§°å­—ç¬¦è®¡æ•°
        const profileName = document.getElementById('profileName');
        const nameCharCount = document.getElementById('nameCharCount');

        function updateCharCount() {
            const count = profileName.value.length;
            nameCharCount.textContent = count;
        }

        profileName.addEventListener('input', updateCharCount);
        // åˆå§‹åŒ–å­—ç¬¦è®¡æ•°
        updateCharCount();

        // ç ”å‘é£æ ¼æ ‡ç­¾é€‰æ‹©ï¼ˆå•é€‰ï¼Œå¯å–æ¶ˆï¼‰
        const preferenceTags = document.querySelectorAll('.preference-tag');
        let selectedMode = 'balanced';  // é»˜è®¤é€‰ä¸­å‡è¡¡æ¨¡å¼

        preferenceTags.forEach(tag => {
            tag.addEventListener('click', function() {
                const mode = this.getAttribute('data-mode');
                
                // å¦‚æœç‚¹å‡»çš„æ˜¯å·²é€‰ä¸­çš„æ ‡ç­¾ï¼Œåˆ™å–æ¶ˆé€‰æ‹©
                if (selectedMode === mode) {
                    this.classList.remove('selected');
                    selectedMode = null;
                } else {
                    // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„é€‰ä¸­çŠ¶æ€
                    preferenceTags.forEach(t => t.classList.remove('selected'));
                    // é€‰ä¸­å½“å‰æ ‡ç­¾
                    this.classList.add('selected');
                    selectedMode = mode;
                }
            });
        });

        // èœå•åˆ‡æ¢åŠŸèƒ½
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰èœå•é¡¹çš„activeçŠ¶æ€
                menuItems.forEach(i => i.classList.remove('active'));
                // æ·»åŠ å½“å‰èœå•é¡¹çš„activeçŠ¶æ€
                this.classList.add('active');

                // è·å–å¯¹åº”çš„tabåç§°
                const tabName = this.getAttribute('data-tab');
                
                // éšè—æ‰€æœ‰å†…å®¹åŒºåŸŸ
                contentSections.forEach(section => section.classList.remove('active'));
                // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹åŒºåŸŸ
                document.getElementById(`${tabName}-section`).classList.add('active');
            });
        });

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.querySelector('.modal-overlay').style.display = 'none';
        }

        // å…³é—­æŒ‰é’®äº‹ä»¶
        closeBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);

        // ç‚¹å‡»é®ç½©å±‚å…³é—­
        document.querySelector('.modal-overlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // é˜»æ­¢å¼¹çª—å†…å®¹ç‚¹å‡»å…³é—­
        document.querySelector('.settings-modal').addEventListener('click', function(e) {
            e.stopPropagation();
        });

        // å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢
        const passwordToggles = document.querySelectorAll('.password-toggle');
        passwordToggles.forEach(toggle => {
            toggle.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const input = document.getElementById(targetId);
                
                if (input.type === 'password') {
                    input.type = 'text';
                    this.textContent = 'ğŸ‘ï¸â€ğŸ—¨ï¸';
                } else {
                    input.type = 'password';
                    this.textContent = 'ğŸ‘';
                }
            });
        });

        // ä¿å­˜æŒ‰é’®äº‹ä»¶
        saveBtn.addEventListener('click', function() {
            // å¦‚æœåœ¨ä¿®æ”¹å¯†ç é¡µé¢ï¼Œæ‰§è¡Œå¯†ç ä¿®æ”¹é€»è¾‘
            const passwordSection = document.getElementById('password-section');
            const profileSection = document.getElementById('profile-section');
            const preferencesSection = document.getElementById('preferences-section');
            
            if (passwordSection.classList.contains('active')) {
                handlePasswordChange();
            } else if (profileSection.classList.contains('active')) {
                handleProfileSave();
            } else if (preferencesSection.classList.contains('active')) {
                handlePreferencesSave();
            } else {
                // å…¶ä»–è®¾ç½®çš„ä¿å­˜é€»è¾‘
                console.log('ä¿å­˜è®¾ç½®');
                alert('è®¾ç½®å·²ä¿å­˜ï¼');
                closeModal();
            }
        });

        // å¤„ç†ä¸ªäººèµ„æ–™ä¿å­˜
        function handleProfileSave() {
            const name = document.getElementById('profileName').value.trim();
            
            // éªŒè¯åç§°ä¸èƒ½ä¸ºç©º
            if (!name) {
                alert('è¯·è¾“å…¥åç§°');
                return;
            }

            // è·å–å¤´åƒï¼ˆå¦‚æœæœ‰ä¸Šä¼ æ–°å¤´åƒï¼‰
            const avatarFile = avatarInput.files[0];
            
            // è¿™é‡Œå¯ä»¥è°ƒç”¨APIä¿å­˜ä¸ªäººèµ„æ–™
            const profileData = {
                name: name,
                avatar: avatarPreview.src
            };

            console.log('ä¿å­˜ä¸ªäººèµ„æ–™:', profileData);
            
            if (avatarFile) {
                console.log('æ–°ä¸Šä¼ çš„å¤´åƒæ–‡ä»¶:', avatarFile);
            }

            alert('ä¸ªäººèµ„æ–™ä¿å­˜æˆåŠŸï¼');
            closeModal();
        }

        // å¤„ç†ç ”å‘åå¥½ä¿å­˜
        function handlePreferencesSave() {
            const selectionPreference = document.getElementById('selectionPreference').value.trim();
            
            // æ”¶é›†åå¥½è®¾ç½®ï¼ˆä¸¤è€…éƒ½æ˜¯éå¿…å¡«ï¼‰
            const preferencesData = {
                developmentMode: selectedMode || null,  // ç ”å‘é£æ ¼ï¼ˆæ•ˆç‡/å¯å‘/å‡è¡¡ï¼‰
                selectionPreference: selectionPreference || null  // é€‰å‹åå¥½æ–‡æœ¬
            };

            // è¿™é‡Œå¯ä»¥è°ƒç”¨APIä¿å­˜ç ”å‘åå¥½
            console.log('ä¿å­˜ç ”å‘åå¥½:', preferencesData);

            // æ˜¾ç¤ºä¿å­˜çš„é…ç½®ä¿¡æ¯
            let message = 'ç ”å‘åå¥½ä¿å­˜æˆåŠŸï¼\n\n';
            if (selectedMode) {
                const modeNames = {
                    'efficiency': 'æ•ˆç‡æ¨¡å¼',
                    'inspiration': 'å¯å‘æ¨¡å¼',
                    'balanced': 'å‡è¡¡æ¨¡å¼'
                };
                message += `ç ”å‘é£æ ¼ï¼š${modeNames[selectedMode]}\n`;
            } else {
                message += 'ç ”å‘é£æ ¼ï¼šæœªé€‰æ‹©\n';
            }
            
            if (selectionPreference) {
                message += `é€‰å‹åå¥½ï¼šå·²å¡«å†™ï¼ˆ${selectionPreference.length}å­—ï¼‰`;
            } else {
                message += 'é€‰å‹åå¥½ï¼šæœªå¡«å†™';
            }

            alert(message);
            closeModal();
        }

        // å¤„ç†å¯†ç ä¿®æ”¹
        function handlePasswordChange() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // éªŒè¯å¿…å¡«é¡¹
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            // éªŒè¯æ–°å¯†ç é•¿åº¦
            if (newPassword.length < 8 || newPassword.length > 20) {
                alert('å¯†ç é•¿åº¦å¿…é¡»åœ¨8-20ä½ä¹‹é—´');
                return;
            }

            // éªŒè¯å¯†ç å¼ºåº¦ï¼šæ•°å­—/å¤§å†™å­—æ¯/å°å†™å­—æ¯/ç‰¹æ®Šå­—ç¬¦è‡³å°‘3ç§
            const hasNumber = /[0-9]/.test(newPassword);
            const hasUpper = /[A-Z]/.test(newPassword);
            const hasLower = /[a-z]/.test(newPassword);
            const hasSpecial = /[^A-Za-z0-9]/.test(newPassword);
            const typeCount = [hasNumber, hasUpper, hasLower, hasSpecial].filter(Boolean).length;

            if (typeCount < 3) {
                alert('å¯†ç å¿…é¡»åŒ…å«æ•°å­—ã€å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ä¸­çš„è‡³å°‘3ç§');
                return;
            }

            // éªŒè¯ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´
            if (newPassword !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }

            // éªŒè¯æ–°å¯†ç ä¸èƒ½ä¸å½“å‰å¯†ç ç›¸åŒ
            if (currentPassword === newPassword) {
                alert('æ–°å¯†ç ä¸èƒ½ä¸å½“å‰å¯†ç ç›¸åŒ');
                return;
            }

            // è¿™é‡Œå¯ä»¥è°ƒç”¨APIè¿›è¡Œå¯†ç ä¿®æ”¹
            console.log('ä¿®æ”¹å¯†ç :', {
                currentPassword,
                newPassword
            });

            alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('passwordForm').reset();
            
            // å…³é—­å¼¹çª—
            closeModal();
        }

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>

