<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/f4f1acead1b2b1cfc74946089e643749.png">
    <title>CADåŸç†å›¾è§£è¯» - SiliconBom ç¡…å®</title>
    
    <!-- å¼•å…¥å…¬å…±CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/index.css">
    <style>
        body {
            font-family: 'Inter', 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color, #F8FAFC);
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        /* ä¸»å®¹å™¨ - å®Œå…¨æŒ‰ç…§ç¬¬äºŒä¸ªæœ€ä½³å®è·µ */
        .main-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* å¯¹è¯æ¡†åŒºåŸŸ - å®Œå…¨æŒ‰ç…§ç¬¬äºŒä¸ªæœ€ä½³å®è·µçš„practices-chat-containeræ ·å¼ */
        .chat-area {
            flex: 1;
            min-width: 0;
            height: 100%;
            background: #fff;
            display: flex;
            flex-direction: column;
            transition: flex 0.3s ease;
        }

        /* ç ”å‘ç©ºé—´æ‰“å¼€æ—¶ï¼Œå¯¹è¯æ¡†å’Œç ”å‘ç©ºé—´å„å ä¸€åŠ */
        .main-container.has-rd-space .chat-area {
            flex: 1;
        }

        /* ä¿®å¤headerå¸ƒå±€ï¼Œç¡®ä¿æŒ‰é’®å’Œæ ‡é¢˜åœ¨ä¸€è¡Œ */
        .chat-area .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid #E2E8F0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
        }

        .chat-area .chat-back-btn {
            flex-shrink: 0;
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #64748B;
            transition: all 0.2s;
        }

        .chat-area .chat-back-btn:hover {
            background: #F1F5F9;
            color: #334155;
        }

        .chat-area .chat-back-btn svg {
            width: 20px;
            height: 20px;
        }

        .chat-area .chat-title-wrapper {
            display: flex;
            align-items: baseline;
            gap: 8px;
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
        }

        .chat-area .chat-title-main {
            font-size: 18px;
            font-weight: 600;
            color: #334155;
            margin: 0;
            white-space: nowrap;
        }

        .chat-area .chat-title-sub {
            font-size: 13px;
            color: #6DD5E8;
            font-weight: 500;
            white-space: nowrap;
        }

        /* ä¿®å¤headerå¸ƒå±€ï¼Œç¡®ä¿æŒ‰é’®å’Œæ ‡é¢˜åœ¨ä¸€è¡Œ */
        .chat-area .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid #E2E8F0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
            position: relative;
        }

        .chat-area .chat-back-btn {
            flex-shrink: 0;
        }

        .chat-area .chat-title-wrapper {
            display: flex;
            align-items: baseline;
            gap: 8px;
            flex: 1;
            min-width: 0;
            white-space: nowrap;
        }

        /* ç ”å‘ç©ºé—´è§¦å‘æ°”æ³¡ - åœ¨æ ‡é¢˜æ å³è¾¹ */
        .rd-space-trigger {
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: #6DD5E8;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(109, 213, 232, 0.3);
            transition: all 0.3s ease;
            z-index: 20;
        }

        .rd-space-trigger:hover {
            background: #4FC3D9;
            box-shadow: 0 4px 12px rgba(109, 213, 232, 0.4);
            transform: translateY(-50%) scale(1.05);
        }

        .rd-space-trigger.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .rd-space-trigger svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        /* Cursoré£æ ¼çš„loadingæ–‡å­—é«˜äº®æ»‘åŠ¨æ•ˆæœ */
        .loading-text {
            display: inline-block;
            position: relative;
            color: #64748B;
            background: linear-gradient(90deg, #64748B 0%, #94A3B8 50%, #64748B 100%);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        /* ä¸Šä¼ çš„æ–‡ä»¶æ ·å¼ */
        .uploaded-files {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .uploaded-file {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.35);
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .uploaded-file:hover {
            background: rgba(255, 255, 255, 0.35);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .file-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .file-icon.pdf {
            background: #EF4444;
            color: white;
        }

        .file-icon.cad {
            background: #3B82F6;
            color: white;
        }

        /* LoadingçŠ¶æ€æ–‡å­— - ä¸æ˜¯æ°”æ³¡å½¢å¼ */
        .loading-status {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 12px 24px;
            margin: 8px 0;
        }

        .loading-status .loading-text {
            font-size: 14px;
            color: #64748B;
        }

        /* æ–‡ä»¶åé«˜äº®æ•ˆæœ */
        .file-name-highlight {
            color: #6DD5E8;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-color: rgba(109, 213, 232, 0.5);
            transition: all 0.2s;
            font-weight: 500;
        }

        .file-name-highlight:hover {
            color: #4FC3D9;
            text-decoration-color: #4FC3D9;
            background: rgba(109, 213, 232, 0.1);
            padding: 2px 4px;
            border-radius: 4px;
        }

        /* Markdownæ ·å¼ */
        .message-text strong {
            font-weight: 600;
            color: #334155;
        }

        .message-text {
            line-height: 1.8;
        }

        /* æ¶ˆæ¯æ°”æ³¡ - å®½åº¦è‡ªé€‚åº”å†…å®¹ï¼Œè¦†ç›–index.cssçš„æ ·å¼ */
        .chat-area .message-bubble {
            width: fit-content !important;
            min-width: fit-content;
            max-width: 80%;
            display: inline-block;
        }

        .chat-area .message.user .message-bubble {
            width: fit-content !important;
        }

        .chat-area .message.assistant .message-bubble {
            width: fit-content !important;
        }

        /* ç ”å‘ç©ºé—´æŠ½å±‰æ ·å¼ - çœŸæ­£çš„å¹¶æ’å±•ç¤ºï¼Œå„å ä¸€åŠ */
        .rd-space-drawer {
            width: 0;
            height: 100vh;
            background: #FFFFFF;
            box-shadow: -2px 0 16px rgba(15, 23, 42, 0.1);
            display: flex;
            flex-direction: column;
            transition: flex 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 1px solid #E2E8F0;
            overflow: hidden;
            flex-shrink: 0;
        }

        .rd-space-drawer.open {
            flex: 1;
            min-width: 0;
        }

        .rd-space-header {
            padding: 16px 20px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #FFFFFF;
            flex-shrink: 0;
            height: 60px;
        }

        .rd-space-title {
            font-size: 16px;
            font-weight: 600;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rd-space-title svg {
            width: 20px;
            height: 20px;
            color: #64748B;
        }

        .rd-space-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #64748B;
            transition: all 0.2s;
        }

        .rd-space-close:hover {
            background: #F1F5F9;
            color: #334155;
        }

        .rd-space-close svg {
            width: 18px;
            height: 18px;
        }

        .rd-space-tabs {
            display: flex;
            padding: 0 20px;
            border-bottom: 1px solid #E2E8F0;
            background: #FFFFFF;
            flex-shrink: 0;
            gap: 0;
        }

        .rd-space-tab {
            padding: 12px 16px;
            font-size: 13px;
            font-weight: 500;
            color: #64748B;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            margin-bottom: -1px;
        }

        .rd-space-tab:hover {
            color: #334155;
            background: #F1F5F9;
        }

        .rd-space-tab.active {
            color: #6DD5E8;
            border-bottom-color: #6DD5E8;
            background: transparent;
        }

        .rd-space-content {
            flex: 1;
            overflow: hidden;
            padding: 20px;
            background: #F8FAFC;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .rd-space-panel {
            display: none;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .rd-space-panel.active {
            display: flex;
            flex-direction: column;
        }

        /* æœ¬åœ°èµ„æºé¢æ¿æ ·å¼ */
        .local-resources-panel {
            display: flex;
            gap: 12px;
            height: 100%;
            min-height: 0;
            position: relative;
        }

        .resources-sidebar {
            width: 180px;
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 0;
            flex-shrink: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), margin 0.3s ease, opacity 0.3s ease;
            position: relative;
            opacity: 1;
        }

        .resources-sidebar.collapsed {
            width: 0;
            margin: 0;
            border: none;
            opacity: 0;
            overflow: hidden;
        }

        .resources-sidebar-header {
            padding: 12px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            background: #F1F5F9;
            min-height: 40px;
        }

        .resources-sidebar-title {
            font-size: 11px;
            font-weight: 600;
            color: #64748B;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .resources-sidebar-toggle {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #64748B;
            transition: all 0.2s;
            padding: 0;
        }

        .resources-sidebar-toggle:hover {
            background: #E2E8F0;
            color: #334155;
        }

        .resources-sidebar-toggle svg {
            width: 14px;
            height: 14px;
            transition: transform 0.3s ease;
        }

        .resources-sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .resource-category {
            margin-bottom: 16px;
        }

        .resource-category-title {
            font-size: 11px;
            font-weight: 600;
            color: #334155;
            margin-bottom: 8px;
            padding: 4px 8px;
            background: #F1F5F9;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .resource-category-title svg {
            width: 12px;
            height: 12px;
            color: #64748B;
        }

        .resource-file {
            padding: 6px 10px;
            font-size: 12px;
            color: #64748B;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            margin-bottom: 4px;
            display: flex;
            align-items: flex-start;
            gap: 6px;
        }

        .resource-file:hover {
            background: #F1F5F9;
            color: #334155;
        }

        .resource-file.selected {
            background: #DBEAFE;
            color: #1E40AF;
            font-weight: 500;
        }

        .resource-file svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            margin-top: 2px;
            color: #64748B;
        }

        .resource-file.selected svg {
            color: #1E40AF;
        }

        .resource-file-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .resources-content {
            flex: 1;
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-width: 0;
            position: relative;
        }

        /* æ‚¬æµ®å±•å¼€æŒ‰é’® - å®Œå…¨å¤ç”¨rd-space-demo.htmlçš„å®ç° */
        .resources-expand-button {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 32px;
            height: 32px;
            background: #FFFFFF;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #64748B;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.1);
            z-index: 10;
        }

        .resources-expand-button:hover {
            background: #F1F5F9;
            border-color: #6DD5E8;
            color: #334155;
            box-shadow: 0 4px 12px rgba(109, 213, 232, 0.2);
        }

        .resources-expand-button svg {
            width: 16px;
            height: 16px;
        }

        .resources-sidebar.collapsed ~ .resources-content .resources-expand-button {
            display: flex;
        }

        /* å†…å®¹åŒºåŸŸæ ‡é¢˜ - å®Œå…¨å¤ç”¨rd-space-demo.htmlçš„å®ç° */
        .resources-content-header {
            display: none;
            padding-bottom: 16px;
            border-bottom: 1px solid #E2E8F0;
            margin-bottom: 24px;
            transition: padding-left 0.3s ease;
        }

        .resources-sidebar.collapsed ~ .resources-content .resources-content-header {
            display: block;
            padding-left: 48px;
        }

        .resources-content-title {
            font-size: 15px;
            font-weight: 600;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .resources-content-title svg {
            width: 18px;
            height: 18px;
            color: #64748B;
        }

        .resources-content-body {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            min-height: 0;
            overflow-y: auto;
        }

        .resources-content-body::-webkit-scrollbar {
            width: 6px;
        }

        .resources-content-body::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 3px;
        }

        /* ç©ºçŠ¶æ€ - å®Œå…¨å¤ç”¨rd-space-demo.htmlçš„å®ç° */
        .empty-state {
            text-align: center;
            padding: 40px 24px;
            color: #94A3B8;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            color: #94A3B8;
            opacity: 0.4;
        }

        .empty-state-text {
            font-size: 13px;
        }

        .resource-preview {
            display: none;
        }

        .resource-preview.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- å¯¹è¯æ¡†åŒºåŸŸ - å®Œå…¨æŒ‰ç…§ç¬¬äºŒä¸ªæœ€ä½³å®è·µçš„ç»“æ„ -->
        <div class="chat-area">
            <!-- å¯¹è¯å¤´éƒ¨ -->
            <div class="chat-header">
                <button class="chat-back-btn" id="chatBackBtn" onclick="window.location.href='index.html?from=practices'">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H6m6-7l-7 7 7 7"></path>
                    </svg>
                </button>
                <div class="chat-title-wrapper">
                    <h1 class="chat-title-main">æœ€ä½³å®è·µ</h1>
                    <span class="chat-title-sub">@ç¡¬ä»¶å·¥ç¨‹å¸ˆå°æ</span>
                </div>
                <!-- ç ”å‘ç©ºé—´è§¦å‘æ°”æ³¡ -->
                <button class="rd-space-trigger" id="rdSpaceTrigger" title="ç ”å‘ç©ºé—´">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                </button>
            </div>

            <!-- æ¶ˆæ¯åŒºåŸŸ - å®Œå…¨æŒ‰ç…§ç¬¬äºŒä¸ªæœ€ä½³å®è·µ -->
            <div class="messages-container" id="messagesContainer">
                <!-- å¯¹è¯å†…å®¹å°†é€šè¿‡JavaScriptè‡ªåŠ¨ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç ”å‘ç©ºé—´æŠ½å±‰ -->
        <div class="rd-space-drawer" id="rdSpaceDrawer">
            <!-- å¤´éƒ¨ -->
            <div class="rd-space-header">
                <div class="rd-space-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>ç ”å‘ç©ºé—´</span>
                </div>
                <button class="rd-space-close" id="rdSpaceClose" title="å…³é—­">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <!-- Tabå¯¼èˆª - åªæ˜¾ç¤ºæœ¬åœ°èµ„æº -->
            <div class="rd-space-tabs">
                <button class="rd-space-tab active" data-tab="local-resources">æœ¬åœ°èµ„æº</button>
            </div>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="rd-space-content">
                <!-- æœ¬åœ°èµ„æºé¢æ¿ -->
                <div class="rd-space-panel active" id="local-resources-panel">
                    <div class="local-resources-panel">
                        <div class="resources-sidebar" id="resourcesSidebar">
                            <div class="resources-sidebar-header">
                                <span class="resources-sidebar-title">èµ„æºç›®å½•</span>
                                <button class="resources-sidebar-toggle" id="resourcesSidebarToggle" title="æ”¶èµ·/å±•å¼€ç›®å½•">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="resources-sidebar-content" id="resourcesSidebarContent">
                                <!-- æ–‡ä»¶åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div class="resources-content">
                            <button class="resources-expand-button" id="resourcesExpandButton" title="å±•å¼€ç›®å½•">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </button>
                            <div class="resources-content-header">
                                <div class="resources-content-title">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                    </svg>
                                    <span id="resourcesCurrentFile">é€‰æ‹©æ–‡ä»¶æŸ¥çœ‹è¯¦æƒ…</span>
                                </div>
                            </div>
                            <div class="resources-content-body" id="resourcesContentBody">
                                <div class="empty-state">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                    </svg>
                                    <div class="empty-state-text">é€‰æ‹©å·¦ä¾§æ–‡ä»¶æŸ¥çœ‹è¯¦æƒ…</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®Œå…¨æŒ‰ç…§ç¬¬äºŒä¸ªæœ€ä½³å®è·µçš„ç»“æ„
        const messagesContainer = document.getElementById('messagesContainer');
        
        // å­˜å‚¨æ‰€æœ‰å®šæ—¶å™¨çš„IDï¼Œç”¨äºæ¸…ç†
        let practiceTimers = [];
        
        // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨çš„å‡½æ•°
        function clearAllPracticeTimers() {
            // æ¸…é™¤æ‰€æœ‰ setTimeout
            practiceTimers.forEach(timerId => {
                if (timerId) {
                    clearTimeout(timerId);
                }
            });
            practiceTimers = [];
        }

        // å®šä¹‰çš„æ–‡ä»¶åˆ—è¡¨
        const files = [
            { name: 'ç”µæºæ¨¡å—è®¾è®¡éœ€æ±‚.pdf', type: 'pdf' },
            { name: 'åŸç†å›¾è®¾è®¡.dwg', type: 'dwg' }
        ];

        // è·å–æ–‡ä»¶ç±»å‹æ ‡è¯†
        function getFileType(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            if (['dwg', 'dxf', 'dwf'].includes(ext)) return 'CAD';
            if (['pdf'].includes(ext)) return 'PDF';
            return 'FILE';
        }

        // è·å–å½“å‰æ—¶é—´
        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // æ¸²æŸ“å¯¹è¯å†…å®¹ - å®Œå…¨æŒ‰ç…§ç¬¬äºŒä¸ªæœ€ä½³å®è·µçš„ç»“æ„
        function renderCadPracticeChatMessages() {
            if (!messagesContainer) return;
            
            const filesHtml = files.map(file => {
                const fileType = getFileType(file.name);
                return `
                    <div class="uploaded-file">
                        <div class="file-icon ${fileType.toLowerCase()}">${fileType}</div>
                        <span>${file.name}</span>
                    </div>
                `;
            }).join('');
            
            messagesContainer.innerHTML = `
                <!-- ç”¨æˆ·æ¶ˆæ¯ - å¸¦æ–‡ä»¶ -->
                <div class="message user">
                    <div class="message-avatar">ğŸ‘¤</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text">
                                åŸºäºè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¸®æˆ‘è§£è¯»ä¸€ä¸‹è®¾è®¡éœ€æ±‚
                            </div>
                            <div class="uploaded-files">${filesHtml}</div>
                        </div>
                    </div>
                </div>

                <!-- åŠ©æ‰‹loadingæ–‡å­— - ä¸æ˜¯æ°”æ³¡å½¢å¼ -->
                <div class="loading-status" id="loadingStatus">
                    <span class="loading-text">æ­£åœ¨è¯»å–${files[0].name}...</span>
                </div>
            `;
            
            // ä¸ºç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶æ·»åŠ ç‚¹å‡»äº‹ä»¶
            const uploadedFiles = messagesContainer.querySelectorAll('.uploaded-file');
            uploadedFiles.forEach((fileElement, index) => {
                fileElement.style.cursor = 'pointer';
                fileElement.addEventListener('click', () => {
                    const fileName = files[index].name;
                    openRdSpaceAndLocateFile(fileName);
                });
            });
            
            // è‡ªåŠ¨æ‰§è¡Œloadingè¿‡ç¨‹
            const timer1 = setTimeout(() => {
                simulateFileReading();
            }, 1500);
            practiceTimers.push(timer1);
        }
        
        // æ¨¡æ‹Ÿè¯»å–æ–‡ä»¶çš„loadingè¿‡ç¨‹
        function simulateFileReading() {
            const loadingStatus = document.getElementById('loadingStatus');
            if (!loadingStatus) return;

            let currentFileIndex = 0;
            const fileNames = files.map(f => f.name);

            const updateLoading = () => {
                if (currentFileIndex < fileNames.length) {
                    const fileName = fileNames[currentFileIndex];
                    // æ–‡ä»¶åé«˜äº®æ˜¾ç¤ºï¼ˆä¸å¯ç‚¹å‡»ï¼‰
                    loadingStatus.innerHTML = `<span class="loading-text">æ­£åœ¨è¯»å–${fileName}...</span>`;
                    
                    currentFileIndex++;
                    const timer = setTimeout(updateLoading, 2000);
                    practiceTimers.push(timer);
                } else {
                    // æ‰€æœ‰æ–‡ä»¶è¯»å–å®Œæˆï¼Œç«‹å³æ¸…é™¤loadingæ–‡å­—å¹¶æ˜¾ç¤ºæœ€ç»ˆå›å¤
                    loadingStatus.remove();
                    // ç›´æ¥æ˜¾ç¤ºæœ€ç»ˆå›å¤
                    const timer = setTimeout(() => {
                        showFinalReply();
                    }, 500);
                    practiceTimers.push(timer);
                }
            };

            const timer = setTimeout(updateLoading, 2000);
            practiceTimers.push(timer);
        }

        // ç ”å‘ç©ºé—´ç›¸å…³å˜é‡
        let rdSpaceDrawer = null;
        let rdSpaceTrigger = null;
        let rdSpaceClose = null;
        let isRdSpaceOpen = false;

        // åˆå§‹åŒ–ç ”å‘ç©ºé—´
        function initRdSpace() {
            rdSpaceDrawer = document.getElementById('rdSpaceDrawer');
            rdSpaceTrigger = document.getElementById('rdSpaceTrigger');
            rdSpaceClose = document.getElementById('rdSpaceClose');

            if (rdSpaceTrigger) {
                rdSpaceTrigger.addEventListener('click', openRdSpace);
            }

            if (rdSpaceClose) {
                rdSpaceClose.addEventListener('click', closeRdSpace);
            }

            // åˆå§‹åŒ–æœ¬åœ°èµ„æºæ–‡ä»¶åˆ—è¡¨
            initLocalResources();
        }

        // æ‰“å¼€ç ”å‘ç©ºé—´
        function openRdSpace() {
            if (!rdSpaceDrawer) return;
            rdSpaceDrawer.classList.add('open');
            document.querySelector('.main-container').classList.add('has-rd-space');
            if (rdSpaceTrigger) {
                rdSpaceTrigger.classList.add('hidden');
            }
            isRdSpaceOpen = true;
        }

        // å…³é—­ç ”å‘ç©ºé—´
        function closeRdSpace() {
            if (!rdSpaceDrawer) return;
            rdSpaceDrawer.classList.remove('open');
            document.querySelector('.main-container').classList.remove('has-rd-space');
            if (rdSpaceTrigger) {
                rdSpaceTrigger.classList.remove('hidden');
            }
            isRdSpaceOpen = false;
        }

        // æ‰“å¼€ç ”å‘ç©ºé—´å¹¶å®šä½åˆ°æ–‡ä»¶
        function openRdSpaceAndLocateFile(fileName) {
            // å¦‚æœç ”å‘ç©ºé—´æœªæ‰“å¼€ï¼Œå…ˆæ‰“å¼€
            if (!isRdSpaceOpen) {
                openRdSpace();
            }
            
            // å®šä½åˆ°æ–‡ä»¶
            locateFileInRdSpace(fileName);
        }

        // åœ¨ç ”å‘ç©ºé—´ä¸­å®šä½æ–‡ä»¶
        function locateFileInRdSpace(fileName) {
            const resourceFiles = document.querySelectorAll('.resource-file');
            resourceFiles.forEach(file => {
                file.classList.remove('selected');
                const fileElement = file.querySelector('.resource-file-name');
                if (fileElement && fileElement.textContent === fileName) {
                    file.classList.add('selected');
                    // æ»šåŠ¨åˆ°è¯¥æ–‡ä»¶
                    file.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
                    showFilePreview(fileName);
                }
            });
        }

        // åˆå§‹åŒ–æœ¬åœ°èµ„æº
        function initLocalResources() {
            const resourcesSidebarContent = document.getElementById('resourcesSidebarContent');
            if (!resourcesSidebarContent) return;

            // æŒ‰æ–‡ä»¶ç±»å‹åˆ†ç»„
            const pdfFiles = files.filter(f => f.type === 'pdf');
            const cadFiles = files.filter(f => f.type === 'dwg');

            let html = '';

            // PDFæ–‡ä»¶
            if (pdfFiles.length > 0) {
                html += `
                    <div class="resource-category">
                        <div class="resource-category-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            æ–‡æ¡£
                        </div>
                `;
                pdfFiles.forEach(file => {
                    html += `
                        <div class="resource-file" data-file="${file.name}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            <span class="resource-file-name">${file.name}</span>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // CADæ–‡ä»¶
            if (cadFiles.length > 0) {
                html += `
                    <div class="resource-category">
                        <div class="resource-category-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="9" y1="3" x2="9" y2="21"></line>
                            </svg>
                            CAD
                        </div>
                `;
                cadFiles.forEach(file => {
                    html += `
                        <div class="resource-file" data-file="${file.name}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            <span class="resource-file-name">${file.name}</span>
                        </div>
                    `;
                });
                html += '</div>';
            }

            resourcesSidebarContent.innerHTML = html;

            // ä¸ºæ–‡ä»¶æ·»åŠ ç‚¹å‡»äº‹ä»¶
            const resourceFiles = resourcesSidebarContent.querySelectorAll('.resource-file');
            resourceFiles.forEach(file => {
                file.addEventListener('click', () => {
                    const fileName = file.dataset.file;
                    selectFile(fileName);
                });
            });

            // ä¾§æ æ”¶èµ·/å±•å¼€åŠŸèƒ½
            const sidebarToggle = document.getElementById('resourcesSidebarToggle');
            const sidebar = document.getElementById('resourcesSidebar');
            const expandButton = document.getElementById('resourcesExpandButton');

            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', () => {
                    sidebar.classList.add('collapsed');
                });
            }

            if (expandButton && sidebar) {
                expandButton.addEventListener('click', () => {
                    sidebar.classList.remove('collapsed');
                });
            }
        }

        // é€‰æ‹©æ–‡ä»¶
        function selectFile(fileName) {
            const resourceFiles = document.querySelectorAll('.resource-file');
            resourceFiles.forEach(file => {
                file.classList.remove('selected');
                if (file.dataset.file === fileName) {
                    file.classList.add('selected');
                }
            });

            // æ›´æ–°å½“å‰æ–‡ä»¶æ ‡é¢˜
            const currentFileElement = document.getElementById('resourcesCurrentFile');
            if (currentFileElement) {
                currentFileElement.textContent = fileName;
            }

            // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
            showFilePreview(fileName);
        }

        // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
        function showFilePreview(fileName) {
            const contentBody = document.getElementById('resourcesContentBody');
            if (!contentBody) return;

            // ç®€å•çš„é¢„è§ˆæ•ˆæœ
            const fileType = getFileType(fileName);
            let previewHtml = '';

            if (fileType === 'PDF') {
                previewHtml = `
                    <div class="resource-preview active">
                        <div style="background: #F1F5F9; border-radius: 8px; padding: 40px; text-align: center; color: #64748B;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 64px; height: 64px; margin: 0 auto 16px; color: #EF4444;">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            <div style="font-size: 14px; font-weight: 500;">${fileName}</div>
                            <div style="font-size: 12px; margin-top: 8px; color: #94A3B8;">PDFæ–‡æ¡£é¢„è§ˆ</div>
                        </div>
                    </div>
                `;
            } else if (fileType === 'CAD') {
                previewHtml = `
                    <div class="resource-preview active">
                        <div style="background: #F1F5F9; border-radius: 8px; padding: 40px; text-align: center; color: #64748B;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 64px; height: 64px; margin: 0 auto 16px; color: #3B82F6;">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="9" y1="3" x2="9" y2="21"></line>
                            </svg>
                            <div style="font-size: 14px; font-weight: 500;">${fileName}</div>
                            <div style="font-size: 12px; margin-top: 8px; color: #94A3B8;">CADå›¾çº¸é¢„è§ˆ</div>
                        </div>
                    </div>
                `;
            }

            contentBody.innerHTML = previewHtml;
        }

        // æ˜¾ç¤ºæœ€ç»ˆå›å¤ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
        function showFinalReply() {
            if (!messagesContainer) return;

            // å…ˆç§»é™¤loadingæ¶ˆæ¯
            const loadingMessage = document.querySelector('.message.assistant');
            if (loadingMessage && loadingMessage.id !== 'finalMessage') {
                loadingMessage.remove();
            }

            // åˆ›å»ºæœ€ç»ˆæ¶ˆæ¯å®¹å™¨
            const finalMessage = document.createElement('div');
            finalMessage.className = 'message assistant';
            finalMessage.id = 'finalMessage';
            
            // ä½¿ç”¨markdownæ ¼å¼çš„æ–‡æœ¬
            const fullText = `æˆ‘å·²å®Œæˆåˆ†æï¼Œä»¥ä¸‹æ˜¯å…³é”®è®¾è®¡éœ€æ±‚çš„è§£è¯»ï¼š

**æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚**
â€¢ **è¾“å…¥ç”µæº**ï¼š24V DCè¾“å…¥ï¼Œæ”¯æŒ18V-36Vå®½ç”µå‹èŒƒå›´
â€¢ **è¾“å‡ºç”µæº**ï¼š12V/3Aè¾“å‡ºï¼Œæ•ˆç‡è¦æ±‚â‰¥85%
â€¢ **ä¿æŠ¤åŠŸèƒ½**ï¼šå…·å¤‡è¿‡å‹ã€æ¬ å‹ã€è¿‡æµä¿æŠ¤ï¼Œå“åº”æ—¶é—´<10ms
â€¢ **å·¥ä½œæ¸©åº¦**ï¼š-40Â°C ~ +85Â°Cå·¥ä¸šçº§å·¥ä½œæ¸©åº¦èŒƒå›´

**ç”µè·¯æ‹“æ‰‘ç»“æ„**
ä»åŸç†å›¾åˆ†æï¼Œè¯¥è®¾è®¡é‡‡ç”¨éš”ç¦»å‹DC-DCè½¬æ¢å™¨æ‹“æ‰‘ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š
â€¢ **è¾“å…¥æ»¤æ³¢ç”µè·¯**ï¼šLCæ»¤æ³¢ç½‘ç»œï¼ŒæŠ‘åˆ¶è¾“å…¥å™ªå£°
â€¢ **DC-DCè½¬æ¢æ ¸å¿ƒ**ï¼šé‡‡ç”¨24Vè½¬12Véš”ç¦»æ¨¡å—ï¼Œè¾“å‡ºåŠŸç‡36W
â€¢ **è¾“å‡ºè°ƒèŠ‚ç”µè·¯**ï¼šçº¿æ€§ç¨³å‹å™¨ç”¨äºç²¾ç¡®ç”µå‹è°ƒèŠ‚
â€¢ **ä¿æŠ¤ç”µè·¯**ï¼šé›†æˆè¿‡å‹ã€æ¬ å‹æ£€æµ‹å’Œè¿‡æµä¿æŠ¤

**å…³é”®å™¨ä»¶è¯†åˆ«**
â€¢ **ä¸»æ§MCU**ï¼šHC32F030C8TAï¼ˆåå¤§åŠå¯¼ä½“ï¼‰ï¼Œç”¨äºç³»ç»Ÿæ§åˆ¶å’ŒçŠ¶æ€ç›‘æµ‹
â€¢ **DC-DCæ¨¡å—**ï¼šB2412LS-1WR3ï¼ˆé‡‘å‡é˜³ï¼‰ï¼Œ24Vè½¬12V/3Wéš”ç¦»å‹
â€¢ **åŠŸç‡MOSFET**ï¼šç”¨äºç”µæºåˆ‡æ¢å’Œä¿æŠ¤ï¼Œå‹å·å¾…ç¡®è®¤
â€¢ **æ£€æµ‹ç”µé˜»**ï¼š10mÎ©ç²¾å¯†ç”µé˜»ï¼Œç”¨äºç”µæµæ£€æµ‹

**PCBå¸ƒå±€å»ºè®®**
ä»åŸç†å›¾çš„å¸ƒå±€ä¿¡æ¯æ¥çœ‹ï¼Œå»ºè®®é‡‡ç”¨4å±‚PCBè®¾è®¡ï¼Œç”µæºå’Œåœ°å¹³é¢åˆ†ç¦»ï¼Œä¸»è¦å™¨ä»¶åº”é è¿‘è¾“å…¥è¾“å‡ºç«¯å£ï¼Œä»¥å‡å°‘çº¿è·¯æŸè€—å’ŒEMIå¹²æ‰°ã€‚

å¦‚éœ€å¯¹æŸä¸ªå…·ä½“éƒ¨åˆ†è¿›è¡Œæ·±å…¥åˆ†æï¼Œæˆ–éœ€è¦BOMæ¸…å•ç”Ÿæˆï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚`;

            finalMessage.innerHTML = `
                <div class="message-avatar"></div>
                <div class="message-content">
                    <div class="message-bubble" id="finalMessageBubble">
                        <div class="message-text" id="finalMessageText" style="white-space: pre-wrap;"></div>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(finalMessage);
            
            // æ‰“å­—æœºæ•ˆæœï¼ˆæ”¯æŒmarkdownï¼‰
            typewriterEffectWithMarkdown(document.getElementById('finalMessageText'), fullText);
        }

        // æ‰“å­—æœºæ•ˆæœå‡½æ•°ï¼ˆæ”¯æŒmarkdownï¼‰
        function typewriterEffectWithMarkdown(element, text) {
            if (!element) {
                console.error('typewriterEffectWithMarkdown: element is null');
                return;
            }
            
            // å°†markdownæ ¼å¼è½¬æ¢ä¸ºHTML
            let processedText = text;
            // å°† **æ–‡æœ¬** è½¬æ¢ä¸º <strong>æ–‡æœ¬</strong>
            processedText = processedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            let index = 0;
            const maxWidth = Math.min(800, window.innerWidth * 0.75);
            let htmlContent = '';
            
            function typeChar() {
                if (!element || !element.parentElement) {
                    return;
                }
                
                if (index >= processedText.length) {
                    return;
                }
                
                // æ™®é€šå­—ç¬¦ï¼šé€å­—ç¬¦è¾“å‡º
                const char = processedText[index];
                htmlContent += char;
                element.innerHTML = htmlContent;
                index++;
                
                // åŠ¨æ€è°ƒæ•´æ°”æ³¡å®½åº¦
                const bubble = element.closest('.message-bubble');
                if (bubble) {
                    const currentWidth = element.scrollWidth;
                    if (currentWidth > maxWidth) {
                        bubble.style.maxWidth = maxWidth + 'px';
                        bubble.style.width = maxWidth + 'px';
                    } else {
                        bubble.style.maxWidth = '80%';
                        bubble.style.width = 'fit-content';
                    }
                }
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                if (messagesContainer) {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
                
                // æ ¹æ®å­—ç¬¦ç±»å‹è°ƒæ•´æ‰“å­—é€Ÿåº¦
                let delay = 20;
                if (char === '\n') {
                    delay = 80;
                } else if (char === 'ã€‚' || char === 'ï¼Œ' || char === 'ï¼š' || char === 'ã€') {
                    delay = 40;
                } else if (char === ' ') {
                    delay = 10;
                }
                
                const timer = setTimeout(typeChar, delay);
                practiceTimers.push(timer);
            }
            
            const startTimer = setTimeout(() => {
                typeChar();
            }, 50);
            practiceTimers.push(startTimer);
        }

        // æ‰“å­—æœºæ•ˆæœå‡½æ•°ï¼ˆæ°”æ³¡å®½åº¦åŠ¨æ€è°ƒæ•´ï¼‰
        function typewriterEffect(element, text) {
            if (!element) {
                console.error('typewriterEffect: element is null');
                return;
            }
            
            let index = 0;
            const maxWidth = Math.min(800, window.innerWidth * 0.75); // æœ€å¤§å®½åº¦é™åˆ¶
            
            function typeChar() {
                // æ£€æŸ¥å…ƒç´ æ˜¯å¦è¿˜å­˜åœ¨
                if (!element || !element.parentElement) {
                    console.warn('typewriterEffect: element removed, stopping');
                    return;
                }
                
                if (index >= text.length) {
                    return; // å®Œæˆ
                }
                
                const char = text[index];
                element.textContent = text.substring(0, index + 1);
                
                // åŠ¨æ€è°ƒæ•´æ°”æ³¡å®½åº¦
                const bubble = element.closest('.message-bubble');
                if (bubble) {
                    // è·å–å½“å‰æ–‡æœ¬çš„å®é™…å®½åº¦
                    const currentWidth = element.scrollWidth;
                    
                    // æ ¹æ®æ–‡æœ¬å®½åº¦åŠ¨æ€è°ƒæ•´æ°”æ³¡å®½åº¦
                    if (currentWidth > maxWidth) {
                        // è¶…è¿‡æœ€å¤§å®½åº¦ï¼Œè®¾ç½®ä¸ºæœ€å¤§å®½åº¦ï¼Œè®©æ–‡æœ¬æ¢è¡Œ
                        bubble.style.maxWidth = maxWidth + 'px';
                        bubble.style.width = maxWidth + 'px';
                    } else {
                        // æœªè¶…è¿‡æœ€å¤§å®½åº¦ï¼Œè®©æ°”æ³¡è‡ªé€‚åº”å†…å®¹
                        bubble.style.maxWidth = '80%';
                        bubble.style.width = 'fit-content';
                    }
                }
                
                index++;
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                if (messagesContainer) {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
                
                // æ ¹æ®å­—ç¬¦ç±»å‹è°ƒæ•´æ‰“å­—é€Ÿåº¦
                let delay = 20; // é»˜è®¤20ms
                if (char === '\n') {
                    delay = 80; // æ¢è¡Œç¨æ…¢
                } else if (char === 'ã€‚' || char === 'ï¼Œ' || char === 'ï¼š' || char === 'ã€') {
                    delay = 40; // æ ‡ç‚¹ç¨æ…¢
                } else if (char === ' ') {
                    delay = 10; // ç©ºæ ¼æ›´å¿«
                }
                
                // ä½¿ç”¨setTimeoutç»§ç»­æ‰“å­—
                const timer = setTimeout(typeChar, delay);
                practiceTimers.push(timer);
            }
            
            // å»¶è¿Ÿä¸€å°æ®µæ—¶é—´ç¡®ä¿DOMå·²æ¸²æŸ“ï¼Œç„¶åå¼€å§‹æ‰“å­—
            const startTimer = setTimeout(() => {
                typeChar();
            }, 50);
            practiceTimers.push(startTimer);
        }

        // åœ¨messagesContainerä¸Šç»‘å®šäº‹ä»¶å§”æ‰˜ï¼Œå¤„ç†æ–‡ä»¶åç‚¹å‡»ï¼ˆåªéœ€è¦ç»‘å®šä¸€æ¬¡ï¼‰
        function initFileNameClickDelegate() {
            if (messagesContainer && !messagesContainer.dataset.fileNameDelegateBound) {
                messagesContainer.dataset.fileNameDelegateBound = 'true';
                // ä½¿ç”¨æ•è·é˜¶æ®µï¼Œç¡®ä¿èƒ½æ•è·åˆ°æ‰€æœ‰ç‚¹å‡»
                messagesContainer.addEventListener('click', function(e) {
                    // æ£€æŸ¥ç‚¹å‡»çš„æ˜¯å¦æ˜¯æ–‡ä»¶åé«˜äº®å…ƒç´ æˆ–å…¶å­å…ƒç´ 
                    let target = e.target;
                    let found = false;
                    
                    // å‘ä¸Šéå†DOMæ ‘ï¼ŒæŸ¥æ‰¾file-name-highlightå…ƒç´ 
                    while (target && target !== messagesContainer && target !== document.body) {
                        if (target.classList && target.classList.contains('file-name-highlight')) {
                            e.stopPropagation();
                            e.preventDefault();
                            const fileName = target.dataset.fileName;
                            if (fileName) {
                                console.log('ç‚¹å‡»æ–‡ä»¶å:', fileName); // è°ƒè¯•ç”¨
                                openRdSpaceAndLocateFile(fileName);
                            }
                            found = true;
                            break;
                        }
                        target = target.parentElement;
                    }
                }, true); // ä½¿ç”¨æ•è·é˜¶æ®µ
                
                console.log('æ–‡ä»¶åç‚¹å‡»äº‹ä»¶å§”æ‰˜å·²ç»‘å®š'); // è°ƒè¯•ç”¨
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡Œæµç¨‹
        window.addEventListener('load', () => {
            // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨ï¼ˆé˜²æ­¢é‡å¤æ‰§è¡Œï¼‰
            clearAllPracticeTimers();
            // åˆå§‹åŒ–æ–‡ä»¶åç‚¹å‡»äº‹ä»¶å§”æ‰˜ï¼ˆå¿…é¡»åœ¨æœ€å¼€å§‹å°±ç»‘å®šï¼‰
            initFileNameClickDelegate();
            // åˆå§‹åŒ–ç ”å‘ç©ºé—´
            initRdSpace();
            // å¼€å§‹è‡ªåŠ¨æ‰§è¡Œæµç¨‹
            renderCadPracticeChatMessages();
            // Loadingæ—¶æ˜¾ç¤ºç ”å‘ç©ºé—´æ°”æ³¡
            const timer = setTimeout(() => {
                if (rdSpaceTrigger) {
                    rdSpaceTrigger.style.display = 'flex';
                }
            }, 1500);
            practiceTimers.push(timer);
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', () => {
            clearAllPracticeTimers();
        });
    </script>
</body>
</html>
