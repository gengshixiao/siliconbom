<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/f4f1acead1b2b1cfc74946089e643749.png">
    <title>SiliconBom 硅宝</title>
    <style>
        :root {
            --bg-color: #F8FAFC;       /* 浅灰底色 */
            --trace-color: #CBD5E1;    /* 未激活线路颜色 (银灰) */
            --trace-active: #6DD5E8;   /* 激活线路颜色 (淡青色) */
            --chip-body: #FFFFFF;      /* 芯片本体白 */
            --pin-metal: #94A3B8;      /* 引脚金属色 */
            --text-main: #334155;
            --sidebar-w: 260px;
            --sidebar-w-collapsed: 64px;  /* 折叠时的宽度 */
            --transition: 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'PingFang SC', sans-serif; }
        
        body {
            background-color: var(--bg-color);
            /* 背景加上极淡的PCB网格 */
            background-image: radial-gradient(#E2E8F0 1px, transparent 1px);
            background-size: 30px 30px;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* --- 布局容器 --- */
        .layout-wrapper {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* --- 左侧侧边栏 (作为输入源) --- */
        .sidebar-unit {
            width: var(--sidebar-w);
            height: 100vh;
            background: rgba(255, 255, 255, 0.9);
            border-right: 1px solid #E2E8F0;
            display: flex;
            flex-direction: column;
            padding: 0;
            z-index: 20;
            position: relative;
            transition: width 0.3s ease;
            overflow: hidden;
        }
        
        .sidebar-unit.collapsed {
            width: var(--sidebar-w-collapsed);
        }
        
        .sidebar-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #E2E8F0;
            min-height: 64px;
        }
        
        .sidebar-unit.collapsed .sidebar-header {
            justify-content: space-between;
            padding: 16px 8px;
        }
        
        .user-avatar-header {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            display: none;
            flex-shrink: 0;
        }
        
        .sidebar-unit.collapsed .user-avatar-header {
            display: block;
        }
        
        .brand-block {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }
        
        .brand-logo {
            width: auto;
            height: 40px;
            display: block;
            object-fit: contain;
            flex-shrink: 0;
        }
        
        .sidebar-toggle {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748B;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .sidebar-toggle:hover {
            background: #F1F5F9;
            color: var(--trace-active);
        }
        
        .sidebar-toggle svg {
            width: 18px;
            height: 18px;
        }
        
        .sidebar-unit.collapsed .brand-logo {
            display: none;
        }

        /* 搜索框 */
        .sidebar-search {
            padding: 12px 16px;
            border-bottom: 1px solid #E2E8F0;
        }
        
        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .search-input {
            width: 100%;
            padding: 8px 12px 8px 36px;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            background: #F8FAFC;
            font-size: 13px;
            color: #334155;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--trace-active);
            background: #fff;
            box-shadow: 0 0 0 3px rgba(109, 213, 232, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            width: 16px;
            height: 16px;
            color: #94A3B8;
            pointer-events: none;
        }
        
        /* 折叠时隐藏搜索框 */
        .sidebar-unit.collapsed .sidebar-search {
            display: none;
        }
        
        /* 菜单项 */
        .menu-section {
            padding: 8px 0;
        }
        
        /* 折叠时隐藏包含项目列表的section */
        .sidebar-unit.collapsed .menu-section.project-section {
            display: none;
        }
        
        /* 折叠时让菜单项均匀分布，减少间距 */
        .sidebar-unit.collapsed .menu-section {
            padding: 4px 0;
        }
        
        /* 折叠时让菜单项之间的间距更均匀 */
        .sidebar-unit.collapsed .sidebar-content {
            display: flex;
            flex-direction: column;
        }
        
        /* 折叠时调整菜单项的内边距，使其更紧凑 */
        .sidebar-unit.collapsed .menu-item {
            padding: 12px;
            margin: 2px 0;
        }
        
        .menu-section-title {
            padding: 8px 16px;
            font-size: 11px;
            font-weight: 600;
            color: #94A3B8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sidebar-unit.collapsed .menu-section-title {
            display: none;
        }
        
        .menu-item {
            position: relative;
            padding: 10px 16px;
            cursor: pointer;
            color: #64748B;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: 0;
        }
        
        .menu-item:hover {
            background: #F1F5F9;
            color: var(--trace-active);
        }
        
        .menu-item.active {
            background: #F1F5F9;
            color: var(--trace-active);
        }
        
        .menu-item-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .menu-item-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .menu-item-text {
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .sidebar-unit.collapsed .menu-item {
            justify-content: center;
            padding: 10px;
        }
        
        .sidebar-unit.collapsed .menu-item-text {
            display: none;
        }
        
        /* 折叠状态下的tooltip */
        .sidebar-unit.collapsed .menu-item {
            position: relative;
        }
        
        .menu-item-tooltip {
            position: fixed;
            padding: 6px 10px;
            background: #1E293B;
            color: #fff;
            font-size: 12px;
            white-space: nowrap;
            border-radius: 4px;
            z-index: 10000;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
        }
        
        .menu-item-tooltip.show {
            opacity: 1;
            visibility: visible;
        }
        
        .menu-item-tooltip::before {
            content: '';
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-right: 0;
            width: 0;
            height: 0;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-right: 5px solid #1E293B;
        }
        
        /* 历史项目列表 */
        .project-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .project-item {
            padding: 8px 16px 8px 44px;
            cursor: pointer;
            color: #64748B;
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            position: relative;
        }
        
        .project-item:hover {
            background: #F1F5F9;
            color: var(--trace-active);
        }
        
        /* 三个点按钮 */
        .project-item-more {
            margin-left: auto;
            width: 20px;
            height: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #94A3B8;
            border-radius: 4px;
            transition: all 0.2s;
            flex-shrink: 0;
            opacity: 0;
            transform: scale(0.8);
        }
        
        .project-item:hover .project-item-more {
            display: flex;
            opacity: 1;
            transform: scale(1);
        }
        
        .project-item-more:hover {
            background: rgba(148, 163, 184, 0.1);
            color: #64748B;
        }
        
        .project-item-more svg {
            width: 16px;
            height: 16px;
        }
        
        /* 气泡菜单 */
        .project-item-menu {
            position: fixed;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 4px;
            min-width: 120px;
            z-index: 10001;
            display: none;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.2s, transform 0.2s;
            border: 1px solid #E2E8F0;
        }
        
        .project-item-menu.show {
            display: block;
            opacity: 1;
            transform: scale(1);
        }
        
        .project-item-menu-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 13px;
            color: #334155;
            transition: background 0.2s;
        }
        
        .project-item-menu-item:hover {
            background: #F1F5F9;
        }
        
        .project-item-menu-item.delete {
            color: #EF4444;
        }
        
        .project-item-menu-item.delete:hover {
            background: #FEE2E2;
        }
        
        .project-item-menu-item-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .project-item-menu-item-icon svg {
            width: 100%;
            height: 100%;
        }
        
        .project-item-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            color: #94A3B8;
        }
        
        .sidebar-unit.collapsed .project-item {
            padding: 8px;
            justify-content: center;
        }
        
        .sidebar-unit.collapsed .project-item-icon,
        .sidebar-unit.collapsed .project-item-text {
            display: none;
        }
        
        .sidebar-unit.collapsed .project-item-more,
        .sidebar-unit.collapsed .project-item-menu {
            display: none !important;
        }
        
        .view-all-link {
            padding: 8px 16px 8px 44px;
            color: #94A3B8;
            font-size: 12px;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .view-all-link:hover {
            color: var(--trace-active);
        }
        
        .sidebar-unit.collapsed .view-all-link {
            display: none;
        }
        
        /* 用户信息区域 */
        .user-block {
            margin-top: auto;
            padding: 16px;
            border-top: 1px solid #E2E8F0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--trace-active) 0%, #4DB6AC 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .user-info {
            flex: 1;
            min-width: 0;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: #334155;
            margin-bottom: 2px;
        }
        
        .user-license {
            font-size: 11px;
            color: #64748B;
            background: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%);
            border: 1px solid #CBD5E1;
            border-radius: 12px;
            padding: 4px 10px;
            display: inline-block;
            font-weight: 500;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            letter-spacing: 0.5px;
        }
        
        .sidebar-unit.collapsed .user-info {
            display: none;
        }
        
        .sidebar-unit.collapsed .user-block {
            justify-content: center;
            padding: 16px 8px;
        }


        /* --- 核心可视区 --- */
        .main-viewport {
            flex: 1;
            position: relative;
            height: 100vh;
            overflow: hidden;
        }

        /* --- 楼层容器：支持上下楼层切换 --- */
        .floors-container {
            width: 100%;
            height: 300vh; /* 3 层：教程、工作台、最佳实践 */
            transition: transform var(--transition);
            will-change: transform;
            /* 初始显示工作台（第二层），不改变首屏视觉 */
            transform: translateY(-100vh);
        }

        .floors-container.is-tutorial {
            /* 切到"教程页"（第一层），工作台会往下移动 */
            transform: translateY(0);
        }

        .floors-container.is-practices {
            /* 切到"最佳实践页"（第三层），工作台会往上移动 */
            transform: translateY(-200vh);
        }

         .floor {
             height: 100vh;
             width: 100%;
             display: flex;
             align-items: center;
             justify-content: center;
             position: relative;
         }

         /* 教程页卡片占位 */
        .tutorial-card {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            width: 900px;
            max-width: 90vw;
            min-height: 520px;
            padding: 40px 48px 36px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 20px 48px rgba(15, 23, 42, 0.12);
            border: 1px solid #E2E8F0;
            z-index: 5;
        }

        .tutorial-card h2 {
            margin-bottom: 16px;
            font-size: 24px;
            color: #0f172a;
        }

        .tutorial-card p {
            color: #475569;
            line-height: 1.7;
            font-size: 15px;
        }

        /* --- 最佳实践页面样式 --- */
        .practices-container {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            width: 1000px;
            max-width: 92vw;
            z-index: 5;
        }

        .practices-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 20px 48px rgba(15, 23, 42, 0.12);
            border: 1px solid #E2E8F0;
            padding: 40px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 32px;
        }

        .practice-item {
            position: relative;
            background: #F8FAFC;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #E2E8F0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .practice-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(15, 23, 42, 0.1);
            border-color: #6DD5E8;
        }

        .practice-bg {
            position: relative;
            height: 140px;
            background: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .practice-bg-text {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: 600;
            color: #CBD5E1;
            letter-spacing: 2px;
            opacity: 0.6;
        }

        .practice-pin {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 18px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .practice-content {
            padding: 20px;
            background: #fff;
            border-radius: 0 0 12px 12px;
        }

        .practice-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .practice-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #F1F5F9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .practice-user {
            font-size: 12px;
            color: #64748B;
            font-weight: 500;
        }

        .practice-title {
            font-size: 18px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 8px;
        }

        .practice-desc {
            font-size: 13px;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .practice-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .practice-tag {
            font-size: 11px;
            padding: 4px 10px;
            background: #F1F5F9;
            color: #64748B;
            border-radius: 12px;
            font-weight: 500;
        }

        /* --- SVG 线路层 (最底层) --- */
        /* 这个SVG负责绘制从侧边栏到芯片，以及芯片上下延伸的所有线路 */
        .pcb-layer-svg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; /* 让点击穿透 */
            z-index: 1;
        }

         /* 线路样式 */
         .trace-path {
             fill: none;
             stroke: var(--trace-color);
             stroke-width: 1.5;
             vector-effect: non-scaling-stroke; /* 防止缩放变粗 */
             transition: stroke 0.6s ease, stroke-width 0.6s ease, filter 0.6s ease;
         }
         .trace-path.active {
             stroke: var(--trace-active);
             stroke-width: 2;
             filter: drop-shadow(0 0 2px rgba(109, 213, 232, 0.4));
         }
         
         /* 呼吸灯效果 */
         .trace-path.breathing {
             animation: breathingGlow var(--breathing-duration, 9s) ease-in-out infinite;
         }
         
         @keyframes breathingGlow {
             0%, 100% {
                 stroke: var(--trace-color);
                 stroke-width: 1.5;
                 filter: none;
                 opacity: 0.7;
             }
             50% {
                 stroke: var(--trace-active);
                 stroke-width: 2.5;
                 filter: drop-shadow(0 0 4px rgba(109, 213, 232, 0.5));
                 opacity: 1;
             }
         }
         
         /* 电流传导效果 - 实线脉冲 */
         .trace-path.current-flow {
             stroke: var(--trace-active);
             stroke-width: 2.5;
             filter: drop-shadow(0 0 8px rgba(109, 213, 232, 0.6));
             animation: currentFlowPulse var(--current-flow-duration, 3.6s) ease-in-out;
         }
         
         @keyframes currentFlowPulse {
             0% {
                 opacity: 0.4;
                 stroke-width: 2;
             }
             50% {
                 opacity: 1;
                 stroke-width: 3;
             }
             100% {
                 opacity: 0.4;
                 stroke-width: 2;
             }
         }
         
         
         /* 电流脉冲效果（用于节点） */
         .current-pulse {
             animation: currentPulse 1.5s ease-in-out infinite;
         }
         
         @keyframes currentPulse {
             0%, 100% {
                 opacity: 0.4;
                 transform: scale(1);
             }
             50% {
                 opacity: 1;
                 transform: scale(1.2);
             }
         }
         
         /* 楼层切换节点按钮 */
         .floor-node {
             cursor: pointer;
             transition: all 0.3s ease;
             pointer-events: auto;
             /* 避免 SVG transform 导致命中区域抖动 */
             transform-box: fill-box;
             transform-origin: center;
         }
         
         .floor-node:hover {
             /* 不再缩放，避免 hover “抽动” */
             transform: none;
         }
         
         .floor-node:hover circle:first-child {
             fill: #E0F7FA;
             stroke: var(--trace-active);
             stroke-width: 3;
             filter: drop-shadow(0 0 8px rgba(109, 213, 232, 0.4));
         }
         
         .floor-node:hover path {
             stroke: var(--trace-active);
             stroke-width: 2.5;
         }
         
         .floor-node:active {
             transform: scale(0.95);
         }

         /* 楼层节点 hover 文案（默认隐藏，hover 显示） */
         .floor-node-bubble {
             opacity: 0;
             pointer-events: none;
             transition: opacity 0.18s ease, transform 0.18s ease;
             transform: translateY(2px);
         }

         .floor-node:hover .floor-node-bubble {
             opacity: 1;
             transform: translateY(0);
         }

         .floor-node-bubble-bg {
             fill: rgba(255, 255, 255, 0.95);
             stroke: rgba(109, 213, 232, 0.35);
             stroke-width: 1.5;
             filter: drop-shadow(0 6px 14px rgba(15, 23, 42, 0.12));
         }

         .floor-node-label {
             fill: #4DB6AC;
             font-size: 12px;
             font-weight: 700;
         }


        /* --- 核心芯片本体 (Central Chip) --- */
        .chip-package {
            width: 680px;
            height: 400px; /* 更大的操作区 */
            background: var(--chip-body);
            border-radius: 4px; /* 芯片通常是尖角的，或者倒角很小 */
            box-shadow: 
                0 0 0 1px #E2E8F0, /* 边框 */
                0 20px 40px -10px rgba(0,0,0,0.1); /* 悬浮阴影 */
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            padding: 2px; /* 给引脚留出一点内边距 */
        }

        /* 芯片表面的文字丝印 */
        .chip-marking {
            position: absolute;
            top: 15px; right: 20px;
            font-family: 'Courier New', monospace;
            font-size: 10px; color: #CBD5E1;
            text-align: right;
            pointer-events: none;
        }

        /* 四周的引脚容器 */
        .pin-array {
            position: absolute;
            display: flex;
            justify-content: center;
            gap: 15px; /* 引脚间距 */
        }
        /* 定位引脚阵列 */
        .pin-array.top { top: -10px; left: 0; width: 100%; }
        .pin-array.bottom { bottom: -10px; left: 0; width: 100%; }
        .pin-array.left { left: -10px; top: 0; height: 100%; flex-direction: column; align-items: center; }
        .pin-array.right { right: -10px; top: 0; height: 100%; flex-direction: column; align-items: center; }

        /* 单个引脚样式 */
        .pin-lead {
            width: 8px; height: 10px;
            background: linear-gradient(135deg, #E2E8F0 0%, #94A3B8 100%);
            border-radius: 1px;
            position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        /* 侧边引脚旋转 */
        .pin-array.left .pin-lead, .pin-array.right .pin-lead { width: 10px; height: 8px; }

        /* 激活的引脚 */
        .pin-lead.active {
            background: linear-gradient(135deg, var(--trace-active) 0%, #4DB6AC 100%);
            box-shadow: 0 0 8px var(--trace-active), 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .pin-lead.active::after {
            content: ''; 
            position: absolute; 
            inset: 0;
            background: var(--trace-active);
            box-shadow: 0 0 5px var(--trace-active);
            opacity: 0.4;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }


        /* 芯片内部UI */
        .chip-interface {
            flex: 1;
            background: #fff;
            margin: 20px;
            border: 1px solid #F1F5F9;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .welcome-area { text-align: center; margin-bottom: 30px; }
        .welcome-area h1 { font-size: 24px; color: #1E293B; margin-bottom: 8px; }
        .welcome-area p { font-size: 14px; color: #64748B; }

        .search-wrapper {
            width: 80%;
            position: relative;
            background: #fff;
            border: 1px solid #E2E8F0;
            border-radius: 12px;
            padding: 16px 20px;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .search-wrapper:focus-within { 
            border-color: var(--trace-active); 
            box-shadow: 0 0 0 3px rgba(109, 213, 232, 0.15); 
        }
        
        .search-wrapper textarea,
        .search-wrapper .input-editor {
            width: 100%;
            min-height: 40px;
            max-height: 200px;
            border: none; 
            background: transparent; 
            outline: none;
            resize: none; 
            font-size: 16px; 
            color: #333;
            line-height: 24px;
            padding: 0;
        }
        
        .search-wrapper .input-editor {
            overflow-y: auto;
            word-wrap: break-word;
        }
        
        .search-wrapper .input-editor:empty::before {
            content: attr(data-placeholder);
            color: #94A3B8;
            font-size: 14px;
        }
        
        .search-wrapper textarea::placeholder {
            color: #94A3B8;
            font-size: 14px;
        }
        
        /* @提及下拉菜单 */
        .mention-dropdown {
            position: fixed;
            background: #fff;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 300px;
            overflow-y: auto;
            z-index: 10001;
            display: none;
            min-width: 240px;
            font-size: 13px;
        }
        
        .mention-dropdown.show {
            display: block;
        }
        
        .mention-item-group {
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 500;
            color: #64748B;
            background: #F8FAFC;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            user-select: none;
        }
        
        .mention-item-group:hover {
            background: #F1F5F9;
        }
        
        .mention-group-icon {
            width: 12px;
            height: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94A3B8;
            transition: transform 0.2s;
        }
        
        .mention-item-group.expanded .mention-group-icon {
            transform: rotate(90deg);
        }
        
        .mention-item-group .folder-icon {
            width: 14px;
            height: 14px;
            color: #F59E0B;
        }
        
        .mention-item-list {
            display: none;
            padding-left: 20px;
        }
        
        .mention-item-group.expanded + .mention-item-list {
            display: block;
        }
        
        .mention-item {
            padding: 4px 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s;
            font-size: 12px;
            color: #334155;
        }
        
        .mention-item:hover,
        .mention-item.selected {
            background: #E0F2FE;
        }
        
        .mention-item-icon {
            width: 10px;
            height: 10px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94A3B8;
        }
        
        .mention-item-text {
            flex: 1;
            font-size: 12px;
        }
        
        /* @提及标签样式 */
        .mention-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #E0F2FE;
            color: #0369A1;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            margin: 0 2px;
            white-space: nowrap;
        }
        
        .mention-tag-icon {
            width: 14px;
            height: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #0EA5E9;
            color: #fff;
            border-radius: 2px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .mention-tag-text {
            display: inline-block;
        }
        
        .input-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .btn-attach,
        .btn-voice {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94A3B8;
            transition: color 0.2s;
            padding: 0;
        }
        
        .btn-attach:hover,
        .btn-voice:hover {
            color: #64748B;
        }
        
        .btn-attach svg,
        .btn-voice svg {
            width: 22px;
            height: 22px;
        }
        
        .btn-send {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #6DD5E8 0%, #4DB6AC 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 0;
            flex-shrink: 0;
        }
        
        .btn-send:hover {
            background: linear-gradient(135deg, #5BC4D7 0%, #3DA69C 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(109, 213, 232, 0.3);
        }
        
        .btn-send svg {
            width: 20px;
            height: 20px;
        }

        /* 研发风格铭牌 */
        .input-actions-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-actions-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            border: 1.5px solid;
            white-space: nowrap;
        }

        .mode-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .mode-badge.balanced {
            background: linear-gradient(135deg, #6DD5E8 0%, #4DB6AC 100%);
            border-color: #6DD5E8;
            color: #fff;
        }

        .mode-badge.efficiency {
            background: linear-gradient(135deg, #F59E0B 0%, #F97316 100%);
            border-color: #F59E0B;
            color: #fff;
        }

        .mode-badge.inspiration {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            border-color: #8B5CF6;
            color: #fff;
        }

        .mode-badge-icon {
            font-size: 14px;
        }

        /* 设置弹窗样式 */
        .settings-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .settings-modal-overlay.show {
            display: flex;
        }

        .settings-modal {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .settings-modal-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-modal-title-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            object-fit: cover;
        }

        .settings-modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background-color 0.2s ease;
            font-size: 20px;
            color: #64748B;
        }

        .settings-modal-close:hover {
            background-color: #F1F5F9;
        }

        .settings-modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        .settings-form-section {
            margin-bottom: 32px;
        }

        .settings-form-section-title {
            font-size: 15px;
            font-weight: 600;
            color: #334155;
            margin-bottom: 12px;
        }

        .settings-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .settings-preference-tag {
            position: relative;
            padding: 10px 20px;
            border: 1.5px solid #E2E8F0;
            border-radius: 24px;
            font-size: 14px;
            color: #334155;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-preference-tag:hover {
            border-color: #6DD5E8;
            background: #F0FDFF;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(109, 213, 232, 0.15);
        }

        .settings-preference-tag.selected {
            border-color: transparent;
            color: #fff;
        }

        .settings-preference-tag[data-mode="balanced"].selected {
            background: linear-gradient(135deg, #6DD5E8 0%, #4DB6AC 100%);
            box-shadow: 0 4px 12px rgba(109, 213, 232, 0.3);
        }

        .settings-preference-tag[data-mode="efficiency"].selected {
            background: linear-gradient(135deg, #F59E0B 0%, #F97316 100%);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .settings-preference-tag[data-mode="inspiration"].selected {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .settings-preference-tag-icon {
            font-size: 16px;
        }

        .settings-preference-tag-tooltip {
            position: absolute;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 12px;
            line-height: 1.5;
            max-width: 320px;
            min-width: 240px;
            white-space: normal;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .settings-preference-tag-tooltip::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-bottom-color: rgba(0, 0, 0, 0.85);
        }

        .settings-preference-tag:hover .settings-preference-tag-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .settings-preference-textarea {
            width: 100%;
            min-height: 180px;
            padding: 12px 16px;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            font-size: 14px;
            color: #334155;
            font-family: inherit;
            resize: vertical;
            transition: all 0.2s ease;
            background: #fff;
            line-height: 1.6;
        }

        .settings-preference-textarea:focus {
            outline: none;
            border-color: #6DD5E8;
            box-shadow: 0 0 0 3px rgba(109, 213, 232, 0.1);
        }

        .settings-preference-textarea::placeholder {
            color: #94A3B8;
            line-height: 1.6;
        }

        .settings-modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #E2E8F0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: #FAFBFC;
        }

        .settings-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .settings-btn-cancel {
            background: #fff;
            color: #334155;
            border: 1px solid #E2E8F0;
        }

        .settings-btn-cancel:hover {
            background: #F8FAFC;
            border-color: #CBD5E1;
        }

        .settings-btn-save {
            background: linear-gradient(135deg, #6DD5E8 0%, #4DB6AC 100%);
            color: #fff;
        }

        .settings-btn-save:hover {
            background: linear-gradient(135deg, #4DB6AC 0%, #6DD5E8 100%);
            box-shadow: 0 4px 12px rgba(109, 213, 232, 0.3);
        }

        .settings-modal-content::-webkit-scrollbar {
            width: 6px;
        }

        .settings-modal-content::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 3px;
        }

        .settings-modal-content::-webkit-scrollbar-thumb:hover {
            background: #94A3B8;
        }
        
         

    </style>
</head>
<body>
    <div class="mention-dropdown" id="mentionDropdown"></div>

    <div class="layout-wrapper">
        
        <aside class="sidebar-unit" id="sidebarUnit">
            <div class="sidebar-content">
                <!-- 头部：Logo和折叠按钮 -->
                <div class="sidebar-header">
                    <div class="brand-block">
                        <img src="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/6eea20ec6720288f00ee93edfdb0f43d.png" alt="SiliconBom Logo" class="brand-logo">
                    </div>
                    <img src="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/f4f1acead1b2b1cfc74946089e643749.png" alt="用户头像" class="user-avatar-header">
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="折叠/展开侧边栏">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 18l6-6-6-6" id="toggleIconPath"/>
                        </svg>
                    </button>
                </div>
                
                <!-- 搜索框 -->
                <div class="sidebar-search">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" class="search-input" placeholder="搜索" id="searchInput">
                    </div>
                </div>
                
                <!-- 新建项目 -->
                <div class="menu-section">
                    <div class="menu-item" id="newProject" data-tooltip="新建会话">
                        <div class="menu-item-icon">➕</div>
                        <span class="menu-item-text">新建会话</span>
                    </div>
                </div>
                
                <!-- 历史项目列表 -->
                <div class="menu-section project-section">
                    <div class="menu-section-title">
                        <span>会话</span>
                    </div>
                    <div class="project-list" id="projectList">
                        <div class="project-item">
                            <svg class="project-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                            <span class="project-item-text">新电源芯片mos选型</span>
                            <div class="project-item-more">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="19" cy="12" r="1"/>
                                    <circle cx="5" cy="12" r="1"/>
                                </svg>
                            </div>
                            <div class="project-item-menu">
                                <div class="project-item-menu-item rename">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                    </div>
                                    <span>重命名</span>
                                </div>
                                <div class="project-item-menu-item delete">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="3 6 5 6 21 6"/>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        </svg>
                                    </div>
                                    <span>删除</span>
                                </div>
                            </div>
                        </div>
                        <div class="project-item">
                            <svg class="project-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                            <span class="project-item-text">60V参数的mos查询</span>
                            <div class="project-item-more">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="19" cy="12" r="1"/>
                                    <circle cx="5" cy="12" r="1"/>
                                </svg>
                            </div>
                            <div class="project-item-menu">
                                <div class="project-item-menu-item rename">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                    </div>
                                    <span>重命名</span>
                                </div>
                                <div class="project-item-menu-item delete">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="3 6 5 6 21 6"/>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        </svg>
                                    </div>
                                    <span>删除</span>
                                </div>
                            </div>
                        </div>
                        <div class="project-item">
                            <svg class="project-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                            <span class="project-item-text">电源切换模块BOM生成</span>
                            <div class="project-item-more">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="19" cy="12" r="1"/>
                                    <circle cx="5" cy="12" r="1"/>
                                </svg>
                            </div>
                            <div class="project-item-menu">
                                <div class="project-item-menu-item rename">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                    </div>
                                    <span>重命名</span>
                                </div>
                                <div class="project-item-menu-item delete">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="3 6 5 6 21 6"/>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        </svg>
                                    </div>
                                    <span>删除</span>
                                </div>
                            </div>
                        </div>
                        <div class="project-item">
                            <svg class="project-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                            <span class="project-item-text">BOM更新需求分析</span>
                            <div class="project-item-more">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="19" cy="12" r="1"/>
                                    <circle cx="5" cy="12" r="1"/>
                                </svg>
                            </div>
                            <div class="project-item-menu">
                                <div class="project-item-menu-item rename">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                    </div>
                                    <span>重命名</span>
                                </div>
                                <div class="project-item-menu-item delete">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="3 6 5 6 21 6"/>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        </svg>
                                    </div>
                                    <span>删除</span>
                                </div>
                            </div>
                        </div>
                        <div class="project-item">
                            <svg class="project-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                            <span class="project-item-text">BOM中mos替换分析</span>
                            <div class="project-item-more">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="19" cy="12" r="1"/>
                                    <circle cx="5" cy="12" r="1"/>
                                </svg>
                            </div>
                            <div class="project-item-menu">
                                <div class="project-item-menu-item rename">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                    </div>
                                    <span>重命名</span>
                                </div>
                                <div class="project-item-menu-item delete">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="3 6 5 6 21 6"/>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        </svg>
                                    </div>
                                    <span>删除</span>
                                </div>
                            </div>
                        </div>
                        <div class="project-item">
                            <svg class="project-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                            <span class="project-item-text">R26系列同规格产品推荐</span>
                            <div class="project-item-more">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="19" cy="12" r="1"/>
                                    <circle cx="5" cy="12" r="1"/>
                                </svg>
                            </div>
                            <div class="project-item-menu">
                                <div class="project-item-menu-item rename">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                    </div>
                                    <span>重命名</span>
                                </div>
                                <div class="project-item-menu-item delete">
                                    <div class="project-item-menu-item-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="3 6 5 6 21 6"/>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        </svg>
                                    </div>
                                    <span>删除</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="view-all-link" id="viewAllProjects">查看全部</div>
                </div>
                
                <!-- BOM档案 -->
                <div class="menu-section">
                    <div class="menu-item" id="bomArchive" data-tooltip="BOM档案">
                        <div class="menu-item-icon"><img src="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/394bd0c51a35e3834d4861c2acf52db6.png" alt="BOM档案" /></div>
                        <span class="menu-item-text">BOM档案</span>
                    </div>
                </div>
                
                <!-- 知识库 -->
                <div class="menu-section">
                    <div class="menu-item" id="knowledgeBase" data-tooltip="知识库">
                        <div class="menu-item-icon"><img src="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/68006159e84e7d640041b45941a1ecf5.png" alt="知识库" /></div>
                        <span class="menu-item-text">知识库</span>
                    </div>
                </div>
            </div>
            
            <!-- 用户信息 -->
            <div class="user-block">
                <div class="user-avatar">L</div>
                <div class="user-info">
                    <div class="user-name">Engineer.Li</div>
                    <div class="user-license">普通会员</div>
                </div>
            </div>
        </aside>

         <main class="main-viewport">
             <div class="floors-container" id="floorsContainer">
                 <!-- 新页面（教程页）：先留空，但保留底部线路与按钮 -->
                 <section class="floor floor-tutorial">
                     <svg class="pcb-layer-svg pcb-layer-svg--tutorial" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice"></svg>
                    <div class="tutorial-card">
                        <h2>教程内容占位</h2>
                        <p>这里展示核心教程步骤或文档摘要。后续可替换为真实的 markdown / 富文本渲染。</p>
                        <p style="margin-top:8px; color:#6DD5E8;">示例：Step 1 / Step 2 / Step 3 ...</p>
                    </div>
                 </section>
                 
                 <!-- 工作台（当前页面） -->
                 <section class="floor floor-workbench">
                     <!-- SVG内容将由JavaScript动态生成，确保精确连接到芯片引脚 -->
                     <svg class="pcb-layer-svg pcb-layer-svg--workbench" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice"></svg>

                     <div class="chip-package">
                     <div class="chip-marking">
                         SILICON-BOM<br>
                         AI-CORE-V5
                     </div>

                     <div class="pin-array top">
                         <div class="pin-lead"></div>
                         <div class="pin-lead"></div>
                         <div class="pin-lead active"></div>
                         <div class="pin-lead"></div>
                         <div class="pin-lead"></div>
                     </div>
                     <div class="pin-array bottom">
                         <div class="pin-lead"></div>
                         <div class="pin-lead"></div>
                         <div class="pin-lead"></div>
                         <div class="pin-lead active"></div>
                         <div class="pin-lead"></div>
                     </div>
                     <div class="pin-array left">
                         <div class="pin-lead active"></div>
                         <div class="pin-lead"></div>
                         <div class="pin-lead"></div>
                         <div class="pin-lead"></div>
                     </div>
                     <div class="pin-array right">
                         <div class="pin-lead"></div>
                         <div class="pin-lead active"></div>
                         <div class="pin-lead"></div>
                         <div class="pin-lead"></div>
                     </div>

                     <div class="chip-interface">
                         <div class="welcome-area">
                             <h1>硅宝已就绪</h1>
                             <p>随时准备启动研发任务</p>
                         </div>

                         <div class="search-wrapper">
                             <div class="input-editor" id="mainTextarea" contenteditable="true" data-placeholder="请描述需求，输入@可调用BOM档案"></div>
                             <div class="input-actions">
                                 <div class="input-actions-left">
                                     <div class="mode-badge balanced" id="indexModeBadge">
                                         <span class="mode-badge-icon">⚖️</span>
                                         <span id="indexModeBadgeText">均衡模式</span>
                                     </div>
                                 </div>
                                 <div class="input-actions-right">
                                     <button class="btn-attach" type="button" aria-label="上传文件">
                                         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                             <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                                         </svg>
                                     </button>
                                     <button class="btn-voice" type="button" aria-label="语音输入">
                                         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                             <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                             <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                             <line x1="12" y1="19" x2="12" y2="23"></line>
                                             <line x1="8" y1="23" x2="16" y2="23"></line>
                                         </svg>
                                     </button>
                                     <button class="btn-send" type="button" aria-label="发送">
                                         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                             <line x1="22" y1="2" x2="11" y2="13"></line>
                                             <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                         </svg>
                                     </button>
                                 </div>
                             </div>
                         </div>
                     </div>

                 </div>

                 </section>
                 
                 <!-- 最佳实践页面 -->
                 <section class="floor floor-practices">
                     <svg class="pcb-layer-svg pcb-layer-svg--practices" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice"></svg>
                     <div class="practices-container">
                         <div class="practices-card">
                             <div class="practice-item">
                                 <div class="practice-bg">
                                     <div class="practice-bg-text">MATERIAL SEARCH</div>
                                     <div class="practice-pin">📌</div>
                                 </div>
                                 <div class="practice-content">
                                     <div class="practice-header">
                                         <div class="practice-avatar">👨🏻‍💻</div>
                                         <div class="practice-user">@奋斗小青年陈工</div>
                                     </div>
                                     <div class="practice-title">物料检索</div>
                                     <div class="practice-desc">仅需简单描述，快速查找所需物料</div>
                                     <div class="practice-tags">
                                         <span class="practice-tag">高效研发</span>
                                         <span class="practice-tag">数据获取</span>
                                         <span class="practice-tag">智能推荐</span>
                                     </div>
                                 </div>
                             </div>
                             
                             <div class="practice-item">
                                 <div class="practice-bg">
                                     <div class="practice-bg-text">BOM REVIEW</div>
                                     <div class="practice-pin">📌</div>
                                 </div>
                                 <div class="practice-content">
                                     <div class="practice-header">
                                         <div class="practice-avatar">📋</div>
                                         <div class="practice-user">@BOM管理员小陈</div>
                                     </div>
                                     <div class="practice-title">BOM评审</div>
                                     <div class="practice-desc">一键审查内容，轻松获取多版本方案</div>
                                     <div class="practice-tags">
                                         <span class="practice-tag">物料选型</span>
                                         <span class="practice-tag">BOM版本管理</span>
                                     </div>
                                 </div>
                             </div>
                             
                             <div class="practice-item">
                                 <div class="practice-bg">
                                     <div class="practice-bg-text">DEEP RESEARCH</div>
                                     <div class="practice-pin">📌</div>
                                 </div>
                                 <div class="practice-content">
                                     <div class="practice-header">
                                         <div class="practice-avatar">🚀</div>
                                         <div class="practice-user">@不愿意透露姓名的产品大佬</div>
                                     </div>
                                     <div class="practice-title">研发任务研究</div>
                                     <div class="practice-desc">深入分析参数，获取最优器件</div>
                                     <div class="practice-tags">
                                         <span class="practice-tag">替代料查询</span>
                                         <span class="practice-tag">技术参数提取</span>
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </section>
             </div>
         </main>
    </div>

     <script>
         // 侧边栏折叠/展开功能
         (function() {
             const sidebarUnit = document.getElementById('sidebarUnit');
             const sidebarToggle = document.getElementById('sidebarToggle');
             
             if (sidebarToggle && sidebarUnit) {
                 // 从localStorage读取折叠状态
                 const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                 if (isCollapsed) {
                     sidebarUnit.classList.add('collapsed');
                 }
                 
                 // 更新按钮图标方向
                 function updateToggleIcon(collapsed) {
                     const iconPath = sidebarToggle.querySelector('#toggleIconPath');
                     if (iconPath) {
                         if (collapsed) {
                             // 折叠时显示向右箭头（展开图标）
                             iconPath.setAttribute('d', 'M15 18l-6-6 6-6');
                         } else {
                             // 展开时显示向左箭头（折叠图标）
                             iconPath.setAttribute('d', 'M9 18l6-6-6-6');
                         }
                     }
                 }
                 
                 // 切换折叠状态
                 sidebarToggle.addEventListener('click', function() {
                     sidebarUnit.classList.toggle('collapsed');
                     const collapsed = sidebarUnit.classList.contains('collapsed');
                     localStorage.setItem('sidebarCollapsed', collapsed);
                     updateToggleIcon(collapsed);
                 });
                 
                // 初始化按钮图标方向
                updateToggleIcon(isCollapsed);
            }
        })();
        
        // Tooltip功能
        (function() {
            const sidebarUnit = document.getElementById('sidebarUnit');
            let tooltip = null;
            
            function createTooltip() {
                if (!tooltip) {
                    tooltip = document.createElement('div');
                    tooltip.className = 'menu-item-tooltip';
                    document.body.appendChild(tooltip);
                }
                return tooltip;
            }
            
            function showTooltip(element, text) {
                if (!sidebarUnit.classList.contains('collapsed')) {
                    return;
                }
                
                const tooltipEl = createTooltip();
                tooltipEl.textContent = text;
                
                const rect = element.getBoundingClientRect();
                const sidebarRect = sidebarUnit.getBoundingClientRect();
                
                // 计算tooltip位置：在图标右侧
                tooltipEl.style.left = (sidebarRect.right + 8) + 'px';
                tooltipEl.style.top = (rect.top + rect.height / 2) + 'px';
                tooltipEl.style.transform = 'translateY(-50%)';
                
                tooltipEl.classList.add('show');
            }
            
            function hideTooltip() {
                if (tooltip) {
                    tooltip.classList.remove('show');
                }
            }
            
            // 为所有带data-tooltip的菜单项添加事件监听
            const menuItems = document.querySelectorAll('.menu-item[data-tooltip]');
            menuItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    const tooltipText = this.getAttribute('data-tooltip');
                    showTooltip(this, tooltipText);
                });
                
                item.addEventListener('mouseleave', function() {
                    hideTooltip();
                });
            });
            
            // 当侧边栏展开时隐藏tooltip
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'class') {
                        if (!sidebarUnit.classList.contains('collapsed')) {
                            hideTooltip();
                        }
                    }
                });
            });
            
            if (sidebarUnit) {
                observer.observe(sidebarUnit, {
                    attributes: true,
                    attributeFilter: ['class']
                });
            }
        })();
        
        // 楼层切换：workbench <-> tutorial
        function setActiveFloor(target) {
            const container = document.getElementById('floorsContainer');
            if (!container) return;
            container.className = 'floors-container';
            if (target === 'tutorial') {
                container.classList.add('is-tutorial');
            } else if (target === 'practices') {
                container.classList.add('is-practices');
            } else {
                // workbench - 默认状态
            }
        }

         // 教程页：绘制底部线路 + “回到工作台”按钮（SVG）
         function renderTutorialFloor() {
             const floor = document.querySelector('.floor-tutorial');
             const svg = floor?.querySelector('.pcb-layer-svg');
             if (!floor || !svg) return;

             const svgRect = svg.getBoundingClientRect();
             const floorRect = floor.getBoundingClientRect();
             if (!svgRect.width || !svgRect.height) return;

             const viewBox = svg.viewBox.baseVal;
             const scaleX = viewBox.width / svgRect.width;
             const scaleY = viewBox.height / svgRect.height;

            // 固定在页面中心 X，保持与工作台居中对齐感
            const centerX = (floorRect.width / 2) * scaleX;
            const buttonY = viewBox.height - 80;
            
            // 获取教程卡片的位置和尺寸
            const tutorialCard = floor.querySelector('.tutorial-card');
            if (!tutorialCard) return;
            const cardRect = tutorialCard.getBoundingClientRect();
            const cardLeft = (cardRect.left - floorRect.left) * scaleX;
            const cardRight = (cardRect.right - floorRect.left) * scaleX;
            const cardTop = (cardRect.top - floorRect.top) * scaleY;
            const cardBottom = (cardRect.bottom - floorRect.top) * scaleY;
            const cardWidth = cardRect.width * scaleX;
            const cardHeight = cardRect.height * scaleY;
            const cardCenterX = cardLeft + cardWidth / 2;
            const cardCenterY = cardTop + cardHeight / 2;

            svg.innerHTML = '';

            const createPath = (d, className = 'trace-path', strokeWidth = 1.5, opacity = 1) => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', d);
                path.setAttribute('class', className);
                path.setAttribute('stroke-width', strokeWidth);
                if (opacity < 1) path.setAttribute('opacity', opacity);
                return path;
            };

            const createCircle = (cx, cy, r = 3, fill = '#CBD5E1', opacity = 0.9, stroke = null, strokeWidth = 1) => {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', cx);
                circle.setAttribute('cy', cy);
                circle.setAttribute('r', r);
                circle.setAttribute('fill', fill);
                if (opacity < 1) circle.setAttribute('opacity', opacity);
                if (stroke) {
                    circle.setAttribute('stroke', stroke);
                    circle.setAttribute('stroke-width', strokeWidth);
                }
                return circle;
            };

            // 主干线路：从下方按钮延伸到教程卡片底部（不再往上延伸）
            svg.appendChild(createPath(`M${centerX} ${cardBottom + 40} L${centerX} ${buttonY - 22}`, 'trace-path active', 2.5));
            svg.appendChild(createPath(`M${centerX} ${buttonY + 22} L${centerX} ${viewBox.height}`, 'trace-path active', 2.5));
            svg.appendChild(createCircle(centerX, cardBottom + 40, 4, '#6DD5E8', 0.9, '#fff', 1.5));
            svg.appendChild(createCircle(centerX, buttonY - 22, 3.6, '#6DD5E8', 0.9));
            svg.appendChild(createCircle(centerX, buttonY + 22, 3.6, '#6DD5E8', 0.9));

            // 从教程卡片底部延伸的多束竖线到按钮
            const offsets = [-180, -120, -70, -30, 0, 30, 70, 120, 180];
            offsets.forEach((offset, idx) => {
                const x = centerX + offset;
                const isActive = offset === 0;
                const startY = cardBottom + 40 + idx * 5;
                const endY = buttonY - 26;
                
                // 从卡片底部到按钮的线条
                svg.appendChild(createPath(
                    `M${x} ${startY} L${x} ${endY}`,
                    isActive ? 'trace-path active' : 'trace-path',
                    isActive ? 2 : 1.4,
                    isActive ? 1 : 0.7
                ));
                
                // 小节点
                svg.appendChild(createCircle(x, startY, 2.4, isActive ? '#6DD5E8' : '#CBD5E1', 0.8));
                svg.appendChild(createCircle(x, endY, 2.2, isActive ? '#6DD5E8' : '#CBD5E1', 0.7));
            });

            // 从教程卡片左右两侧延伸的线条
            // 左侧线条
            for (let i = 0; i < 6; i++) {
                const y = cardTop + (i + 1) * (cardHeight / 7);
                const offsetX = -80 - i * 25;
                const endX = cardLeft + offsetX;
                
                svg.appendChild(createPath(
                    `M${cardLeft} ${y} L${endX} ${y} L${endX - 30} ${y + (i % 2 === 0 ? -20 : 20)}`,
                    'trace-path',
                    1.3,
                    0.6
                ));
                svg.appendChild(createCircle(cardLeft, y, 2.5, '#CBD5E1', 0.7));
                svg.appendChild(createCircle(endX - 30, y + (i % 2 === 0 ? -20 : 20), 2, '#CBD5E1', 0.5));
            }
            
            // 右侧线条
            for (let i = 0; i < 6; i++) {
                const y = cardTop + (i + 1) * (cardHeight / 7);
                const offsetX = 80 + i * 25;
                const endX = cardRight + offsetX;
                
                svg.appendChild(createPath(
                    `M${cardRight} ${y} L${endX} ${y} L${endX + 30} ${y + (i % 2 === 0 ? 20 : -20)}`,
                    'trace-path',
                    1.3,
                    0.6
                ));
                svg.appendChild(createCircle(cardRight, y, 2.5, '#CBD5E1', 0.7));
                svg.appendChild(createCircle(endX + 30, y + (i % 2 === 0 ? 20 : -20), 2, '#CBD5E1', 0.5));
            }

            // 从教程卡片上方延伸的线条
            for (let i = 0; i < 5; i++) {
                const x = cardLeft + (i + 1) * (cardWidth / 6);
                const offsetY = -60 - i * 20;
                const endY = cardTop + offsetY;
                
                svg.appendChild(createPath(
                    `M${x} ${cardTop} L${x} ${endY} L${x + (i % 2 === 0 ? -25 : 25)} ${endY - 30}`,
                    'trace-path',
                    1.3,
                    0.6
                ));
                svg.appendChild(createCircle(x, cardTop, 2.5, '#CBD5E1', 0.7));
                svg.appendChild(createCircle(x + (i % 2 === 0 ? -25 : 25), endY - 30, 2, '#CBD5E1', 0.5));
            }

            // 添加装饰性背景走线网络（类似主页面）
            const createDecoPath = (d, opacity = 0.25, strokeWidth = 1, dashArray = null) => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', d);
                path.setAttribute('class', 'trace-path');
                path.setAttribute('stroke-width', strokeWidth);
                path.setAttribute('opacity', opacity);
                if (dashArray) path.setAttribute('stroke-dasharray', dashArray);
                return path;
            };

            const createDecoCircle = (cx, cy, r = 2, opacity = 0.3) => {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', cx);
                circle.setAttribute('cy', cy);
                circle.setAttribute('r', r);
                circle.setAttribute('fill', '#CBD5E1');
                circle.setAttribute('opacity', opacity);
                return circle;
            };

            // 四角装饰走线网络
            // 左上角
            for (let i = 0; i < 4; i++) {
                const offsetY = 50 + i * 20;
                svg.appendChild(createDecoPath(`M30 ${offsetY} L${80 + i * 15} ${offsetY} L${100 + i * 15} ${offsetY + 25}`, 0.2));
                svg.appendChild(createDecoCircle(80 + i * 15, offsetY, 2, 0.25));
            }
            
            // 右上角
            for (let i = 0; i < 4; i++) {
                const offsetY = 50 + i * 20;
                svg.appendChild(createDecoPath(`M${viewBox.width - 30} ${offsetY} L${viewBox.width - 80 - i * 15} ${offsetY} L${viewBox.width - 100 - i * 15} ${offsetY + 25}`, 0.2));
                svg.appendChild(createDecoCircle(viewBox.width - 80 - i * 15, offsetY, 2, 0.25));
            }
            
            // 左下角（避开卡片和按钮区域）
            for (let i = 0; i < 4; i++) {
                const offsetY = buttonY + 100 + i * 20;
                if (offsetY < viewBox.height - 50) {
                    svg.appendChild(createDecoPath(`M30 ${offsetY} L${80 + i * 15} ${offsetY} L${100 + i * 15} ${offsetY - 25}`, 0.2));
                    svg.appendChild(createDecoCircle(80 + i * 15, offsetY, 2, 0.25));
                }
            }
            
            // 右下角（避开卡片和按钮区域）
            for (let i = 0; i < 4; i++) {
                const offsetY = buttonY + 100 + i * 20;
                if (offsetY < viewBox.height - 50) {
                    svg.appendChild(createDecoPath(`M${viewBox.width - 30} ${offsetY} L${viewBox.width - 80 - i * 15} ${offsetY} L${viewBox.width - 100 - i * 15} ${offsetY - 25}`, 0.2));
                    svg.appendChild(createDecoCircle(viewBox.width - 80 - i * 15, offsetY, 2, 0.25));
                }
            }

            // 中间区域虚线网络（避开卡片区域）
            const dashPatterns = ['5,3', '8,4', '3,2'];
            for (let i = 0; i < 8; i++) {
                const angle = (i * 45) * Math.PI / 180;
                const startX = cardCenterX + Math.cos(angle) * cardWidth * 0.7;
                const startY = cardCenterY + Math.sin(angle) * cardHeight * 0.7;
                const endX = cardCenterX + Math.cos(angle) * cardWidth * 1.8;
                const endY = cardCenterY + Math.sin(angle) * cardHeight * 2.2;
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                
                // 确保线条不穿过卡片
                if (Math.abs(startX - cardCenterX) > cardWidth * 0.6 || Math.abs(startY - cardCenterY) > cardHeight * 0.6) {
                    svg.appendChild(createDecoPath(
                        `M${startX} ${startY} L${midX} ${midY} L${endX} ${endY}`,
                        0.15, 1, dashPatterns[i % 3]
                    ));
                    svg.appendChild(createDecoCircle(midX, midY, 1.5, 0.2));
                }
            }

            // 交叉网格走线（避开卡片区域）
            for (let i = 0; i < 5; i++) {
                const x = 100 + i * (viewBox.width - 200) / 4;
                if (x < cardLeft - 50 || x > cardRight + 50) {
                    svg.appendChild(createDecoPath(`M${x} 40 L${x} ${cardTop - 30}`, 0.12, 0.8));
                    svg.appendChild(createDecoPath(`M${x} ${cardBottom + 50} L${x} ${buttonY - 50}`, 0.12, 0.8));
                }
            }
            for (let i = 0; i < 4; i++) {
                const y = 60 + i * (cardTop - 60) / 3;
                if (y < cardTop - 20) {
                    svg.appendChild(createDecoPath(`M50 ${y} L${cardLeft - 30} ${y}`, 0.12, 0.8));
                    svg.appendChild(createDecoPath(`M${cardRight + 30} ${y} L${viewBox.width - 50} ${y}`, 0.12, 0.8));
                }
            }

            // 随机装饰性节点和短走线（避开卡片区域）
            for (let i = 0; i < 25; i++) {
                const x = 60 + Math.random() * (viewBox.width - 120);
                let y;
                if (x < cardLeft - 40 || x > cardRight + 40) {
                    y = 50 + Math.random() * (viewBox.height - 150);
                } else {
                    // 如果在卡片上方或下方，避开卡片
                    if (Math.random() > 0.5) {
                        y = 50 + Math.random() * (cardTop - 80);
                    } else {
                        y = cardBottom + 60 + Math.random() * (viewBox.height - cardBottom - 150);
                    }
                }
                
                // 确保不落在卡片内
                if (x < cardLeft - 30 || x > cardRight + 30 || y < cardTop - 30 || y > cardBottom + 30) {
                    svg.appendChild(createDecoCircle(x, y, 1.5, 0.2));
                    // 添加短走线
                    if (i % 3 === 0) {
                        const angle = Math.random() * Math.PI * 2;
                        const len = 20 + Math.random() * 30;
                        svg.appendChild(createDecoPath(
                            `M${x} ${y} L${x + Math.cos(angle) * len} ${y + Math.sin(angle) * len}`,
                            0.15, 0.8
                        ));
                    }
                }
            }

             // 底部“回到工作台”按钮（样式复用 floor-node）
             const backGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
             backGroup.setAttribute('class', 'floor-node');
             backGroup.setAttribute('data-nav', 'to-workbench');
             backGroup.innerHTML = `
                 <circle cx="${centerX}" cy="${buttonY}" r="20" fill="#FFFFFF" stroke="#6DD5E8" stroke-width="2.5"/>
                 <circle cx="${centerX}" cy="${buttonY}" r="15" fill="none" stroke="#CBD5E1" stroke-width="1" stroke-dasharray="2,2"/>
                 <path d="M${centerX - 5} ${buttonY - 3} L${centerX} ${buttonY + 2} L${centerX + 5} ${buttonY - 3}" 
                       fill="none" stroke="#6DD5E8" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                 <circle cx="${centerX}" cy="${buttonY}" r="4" fill="#6DD5E8"/>
                 <!-- 气泡放到按钮上方，避免底部溢出 -->
                 <g class="floor-node-bubble">
                   <rect class="floor-node-bubble-bg" x="${centerX - 50}" y="${buttonY - 58}" width="100" height="28" rx="10" />
                   <text class="floor-node-label" x="${centerX}" y="${buttonY - 44}" text-anchor="middle" dominant-baseline="middle">回到工作台</text>
                 </g>
             `;
             svg.appendChild(backGroup);

             bindFloorNodeEvents(floor);
         }

         // 最佳实践页：绘制顶部线路 + "回到工作台"按钮（SVG）
         function renderPracticesFloor() {
             const floor = document.querySelector('.floor-practices');
             const svg = floor?.querySelector('.pcb-layer-svg');
             if (!floor || !svg) return;

             const svgRect = svg.getBoundingClientRect();
             const floorRect = floor.getBoundingClientRect();
             if (!svgRect.width || !svgRect.height) return;

             const viewBox = svg.viewBox.baseVal;
             const scaleX = viewBox.width / svgRect.width;
             const scaleY = viewBox.height / svgRect.height;

             // 固定在页面中心 X，保持与工作台居中对齐感
             const centerX = (floorRect.width / 2) * scaleX;
             const buttonY = 80; // 顶部按钮位置
             
             // 获取最佳实践卡片容器的位置和尺寸
             const practicesContainer = floor.querySelector('.practices-container');
             if (!practicesContainer) return;
             const containerRect = practicesContainer.getBoundingClientRect();
             const containerLeft = (containerRect.left - floorRect.left) * scaleX;
             const containerRight = (containerRect.right - floorRect.left) * scaleX;
             const containerTop = (containerRect.top - floorRect.top) * scaleY;
             const containerBottom = (containerRect.bottom - floorRect.top) * scaleY;
             const containerWidth = containerRect.width * scaleX;
             const containerHeight = containerRect.height * scaleY;
             const containerCenterX = containerLeft + containerWidth / 2;
             const containerCenterY = containerTop + containerHeight / 2;

             svg.innerHTML = '';

             const createPath = (d, className = 'trace-path', strokeWidth = 1.5, opacity = 1) => {
                 const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                 path.setAttribute('d', d);
                 path.setAttribute('class', className);
                 path.setAttribute('stroke-width', strokeWidth);
                 if (opacity < 1) path.setAttribute('opacity', opacity);
                 return path;
             };

             const createCircle = (cx, cy, r = 3, fill = '#CBD5E1', opacity = 0.9, stroke = null, strokeWidth = 1) => {
                 const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                 circle.setAttribute('cx', cx);
                 circle.setAttribute('cy', cy);
                 circle.setAttribute('r', r);
                 circle.setAttribute('fill', fill);
                 if (opacity < 1) circle.setAttribute('opacity', opacity);
                 if (stroke) {
                     circle.setAttribute('stroke', stroke);
                     circle.setAttribute('stroke-width', strokeWidth);
                 }
                 return circle;
             };

             // 主干线路：从上方按钮延伸到最佳实践卡片顶部（不再往下延伸）
             svg.appendChild(createPath(`M${centerX} 0 L${centerX} ${buttonY - 22}`, 'trace-path active', 2.5));
             svg.appendChild(createPath(`M${centerX} ${buttonY + 22} L${centerX} ${containerTop - 40}`, 'trace-path active', 2.5));
             svg.appendChild(createCircle(centerX, buttonY - 22, 3.6, '#6DD5E8', 0.9));
             svg.appendChild(createCircle(centerX, buttonY + 22, 3.6, '#6DD5E8', 0.9));
             svg.appendChild(createCircle(centerX, containerTop - 40, 4, '#6DD5E8', 0.9, '#fff', 1.5));

             // 从最佳实践卡片顶部延伸的多束竖线到按钮
             const offsets = [-180, -120, -70, -30, 0, 30, 70, 120, 180];
             offsets.forEach((offset, idx) => {
                 const x = centerX + offset;
                 const isActive = offset === 0;
                 const startY = containerTop - 40 - idx * 5;
                 const endY = buttonY + 26;
                 
                 // 从卡片顶部到按钮的线条
                 svg.appendChild(createPath(
                     `M${x} ${startY} L${x} ${endY}`,
                     isActive ? 'trace-path active' : 'trace-path',
                     isActive ? 2 : 1.4,
                     isActive ? 1 : 0.7
                 ));
                 
                 // 小节点
                 svg.appendChild(createCircle(x, startY, 2.4, isActive ? '#6DD5E8' : '#CBD5E1', 0.8));
                 svg.appendChild(createCircle(x, endY, 2.2, isActive ? '#6DD5E8' : '#CBD5E1', 0.7));
             });

             // 从最佳实践卡片左右两侧延伸的线条
             // 左侧线条
             for (let i = 0; i < 6; i++) {
                 const y = containerTop + (i + 1) * (containerHeight / 7);
                 const offsetX = -80 - i * 25;
                 const endX = containerLeft + offsetX;
                 
                 svg.appendChild(createPath(
                     `M${containerLeft} ${y} L${endX} ${y} L${endX - 30} ${y + (i % 2 === 0 ? -20 : 20)}`,
                     'trace-path',
                     1.3,
                     0.6
                 ));
                 svg.appendChild(createCircle(containerLeft, y, 2.5, '#CBD5E1', 0.7));
                 svg.appendChild(createCircle(endX - 30, y + (i % 2 === 0 ? -20 : 20), 2, '#CBD5E1', 0.5));
             }
             
             // 右侧线条
             for (let i = 0; i < 6; i++) {
                 const y = containerTop + (i + 1) * (containerHeight / 7);
                 const offsetX = 80 + i * 25;
                 const endX = containerRight + offsetX;
                 
                 svg.appendChild(createPath(
                     `M${containerRight} ${y} L${endX} ${y} L${endX + 30} ${y + (i % 2 === 0 ? 20 : -20)}`,
                     'trace-path',
                     1.3,
                     0.6
                 ));
                 svg.appendChild(createCircle(containerRight, y, 2.5, '#CBD5E1', 0.7));
                 svg.appendChild(createCircle(endX + 30, y + (i % 2 === 0 ? 20 : -20), 2, '#CBD5E1', 0.5));
             }

             // 从最佳实践卡片下方延伸的线条
             for (let i = 0; i < 5; i++) {
                 const x = containerLeft + (i + 1) * (containerWidth / 6);
                 const offsetY = 60 + i * 20;
                 const endY = containerBottom + offsetY;
                 
                 svg.appendChild(createPath(
                     `M${x} ${containerBottom} L${x} ${endY} L${x + (i % 2 === 0 ? -25 : 25)} ${endY + 30}`,
                     'trace-path',
                     1.3,
                     0.6
                 ));
                 svg.appendChild(createCircle(x, containerBottom, 2.5, '#CBD5E1', 0.7));
                 svg.appendChild(createCircle(x + (i % 2 === 0 ? -25 : 25), endY + 30, 2, '#CBD5E1', 0.5));
             }

             // 添加装饰性背景走线网络（类似教程页）
             const createDecoPath = (d, opacity = 0.25, strokeWidth = 1, dashArray = null) => {
                 const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                 path.setAttribute('d', d);
                 path.setAttribute('class', 'trace-path');
                 path.setAttribute('stroke-width', strokeWidth);
                 path.setAttribute('opacity', opacity);
                 if (dashArray) path.setAttribute('stroke-dasharray', dashArray);
                 return path;
             };

             const createDecoCircle = (cx, cy, r = 2, opacity = 0.3) => {
                 const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                 circle.setAttribute('cx', cx);
                 circle.setAttribute('cy', cy);
                 circle.setAttribute('r', r);
                 circle.setAttribute('fill', '#CBD5E1');
                 circle.setAttribute('opacity', opacity);
                 return circle;
             };

             // 四角装饰走线网络
             // 左上角
             for (let i = 0; i < 4; i++) {
                 const offsetY = 50 + i * 20;
                 svg.appendChild(createDecoPath(`M30 ${offsetY} L${80 + i * 15} ${offsetY} L${100 + i * 15} ${offsetY + 25}`, 0.2));
                 svg.appendChild(createDecoCircle(80 + i * 15, offsetY, 2, 0.25));
             }
             
             // 右上角
             for (let i = 0; i < 4; i++) {
                 const offsetY = 50 + i * 20;
                 svg.appendChild(createDecoPath(`M${viewBox.width - 30} ${offsetY} L${viewBox.width - 80 - i * 15} ${offsetY} L${viewBox.width - 100 - i * 15} ${offsetY + 25}`, 0.2));
                 svg.appendChild(createDecoCircle(viewBox.width - 80 - i * 15, offsetY, 2, 0.25));
             }
             
             // 左下角（避开卡片和按钮区域）
             for (let i = 0; i < 4; i++) {
                 const offsetY = containerBottom + 100 + i * 20;
                 if (offsetY < viewBox.height - 50) {
                     svg.appendChild(createDecoPath(`M30 ${offsetY} L${80 + i * 15} ${offsetY} L${100 + i * 15} ${offsetY - 25}`, 0.2));
                     svg.appendChild(createDecoCircle(80 + i * 15, offsetY, 2, 0.25));
                 }
             }
             
             // 右下角（避开卡片和按钮区域）
             for (let i = 0; i < 4; i++) {
                 const offsetY = containerBottom + 100 + i * 20;
                 if (offsetY < viewBox.height - 50) {
                     svg.appendChild(createDecoPath(`M${viewBox.width - 30} ${offsetY} L${viewBox.width - 80 - i * 15} ${offsetY} L${viewBox.width - 100 - i * 15} ${offsetY - 25}`, 0.2));
                     svg.appendChild(createDecoCircle(viewBox.width - 80 - i * 15, offsetY, 2, 0.25));
                 }
             }

             // 中间区域虚线网络（避开卡片区域）
             const dashPatterns = ['5,3', '8,4', '3,2'];
             for (let i = 0; i < 8; i++) {
                 const angle = (i * 45) * Math.PI / 180;
                 const startX = containerCenterX + Math.cos(angle) * containerWidth * 0.7;
                 const startY = containerCenterY + Math.sin(angle) * containerHeight * 0.7;
                 const endX = containerCenterX + Math.cos(angle) * containerWidth * 1.8;
                 const endY = containerCenterY + Math.sin(angle) * containerHeight * 2.2;
                 const midX = (startX + endX) / 2;
                 const midY = (startY + endY) / 2;
                 
                 // 确保线条不穿过卡片
                 if (Math.abs(startX - containerCenterX) > containerWidth * 0.6 || Math.abs(startY - containerCenterY) > containerHeight * 0.6) {
                     svg.appendChild(createDecoPath(
                         `M${startX} ${startY} L${midX} ${midY} L${endX} ${endY}`,
                         0.15, 1, dashPatterns[i % 3]
                     ));
                     svg.appendChild(createDecoCircle(midX, midY, 1.5, 0.2));
                 }
             }

             // 交叉网格走线（避开卡片区域）
             for (let i = 0; i < 5; i++) {
                 const x = 100 + i * (viewBox.width - 200) / 4;
                 if (x < containerLeft - 50 || x > containerRight + 50) {
                     svg.appendChild(createDecoPath(`M${x} ${buttonY + 50} L${x} ${containerTop - 30}`, 0.12, 0.8));
                     svg.appendChild(createDecoPath(`M${x} ${containerBottom + 50} L${x} ${viewBox.height - 50}`, 0.12, 0.8));
                 }
             }
             for (let i = 0; i < 4; i++) {
                 const y = containerBottom + 60 + i * (viewBox.height - containerBottom - 100) / 3;
                 if (y < viewBox.height - 50) {
                     svg.appendChild(createDecoPath(`M50 ${y} L${containerLeft - 30} ${y}`, 0.12, 0.8));
                     svg.appendChild(createDecoPath(`M${containerRight + 30} ${y} L${viewBox.width - 50} ${y}`, 0.12, 0.8));
                 }
             }

             // 随机装饰性节点和短走线（避开卡片区域）
             for (let i = 0; i < 25; i++) {
                 const x = 60 + Math.random() * (viewBox.width - 120);
                 let y;
                 if (x < containerLeft - 40 || x > containerRight + 40) {
                     y = buttonY + 60 + Math.random() * (viewBox.height - buttonY - 150);
                 } else {
                     // 如果在卡片上方或下方，避开卡片
                     if (Math.random() > 0.5) {
                         y = buttonY + 60 + Math.random() * (containerTop - buttonY - 80);
                     } else {
                         y = containerBottom + 60 + Math.random() * (viewBox.height - containerBottom - 150);
                     }
                 }
                 
                 // 确保不落在卡片内
                 if (x < containerLeft - 30 || x > containerRight + 30 || y < containerTop - 30 || y > containerBottom + 30) {
                     svg.appendChild(createDecoCircle(x, y, 1.5, 0.2));
                     // 添加短走线
                     if (i % 3 === 0) {
                         const angle = Math.random() * Math.PI * 2;
                         const len = 20 + Math.random() * 30;
                         svg.appendChild(createDecoPath(
                             `M${x} ${y} L${x + Math.cos(angle) * len} ${y + Math.sin(angle) * len}`,
                             0.15, 0.8
                         ));
                     }
                 }
             }

             // 顶部"回到工作台"按钮（样式复用 floor-node）
             const backGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
             backGroup.setAttribute('class', 'floor-node');
             backGroup.setAttribute('data-nav', 'to-workbench');
             backGroup.innerHTML = `
                 <circle cx="${centerX}" cy="${buttonY}" r="20" fill="#FFFFFF" stroke="#6DD5E8" stroke-width="2.5"/>
                 <circle cx="${centerX}" cy="${buttonY}" r="15" fill="none" stroke="#CBD5E1" stroke-width="1" stroke-dasharray="2,2"/>
                 <path d="M${centerX - 5} ${buttonY + 3} L${centerX} ${buttonY - 2} L${centerX + 5} ${buttonY + 3}" 
                       fill="none" stroke="#6DD5E8" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                 <circle cx="${centerX}" cy="${buttonY}" r="4" fill="#6DD5E8"/>
                 <!-- 气泡放到按钮下方，避免顶部溢出 -->
                 <g class="floor-node-bubble">
                   <rect class="floor-node-bubble-bg" x="${centerX - 50}" y="${buttonY + 30}" width="100" height="28" rx="10" />
                   <text class="floor-node-label" x="${centerX}" y="${buttonY + 44}" text-anchor="middle" dominant-baseline="middle">回到工作台</text>
                 </g>
             `;
             svg.appendChild(backGroup);

             bindFloorNodeEvents(floor);
         }

         // 动态更新SVG走线，确保精确连接到芯片引脚
         function updateTraces() {
             const floor = document.querySelector('.floor-workbench');
             const svg = floor?.querySelector('.pcb-layer-svg');
             const chipPackage = floor?.querySelector('.chip-package');
             
             if (!svg || !chipPackage || !floor) return;
             
             // 获取所有引脚元素
             const topPins = Array.from(chipPackage.querySelectorAll('.pin-array.top .pin-lead'));
             const bottomPins = Array.from(chipPackage.querySelectorAll('.pin-array.bottom .pin-lead'));
             const leftPins = Array.from(chipPackage.querySelectorAll('.pin-array.left .pin-lead'));
             const rightPins = Array.from(chipPackage.querySelectorAll('.pin-array.right .pin-lead'));
             
             // 计算坐标转换函数
             const svgRect = svg.getBoundingClientRect();
             const floorRect = floor.getBoundingClientRect();
             const viewBox = svg.viewBox.baseVal;
             const scaleX = viewBox.width / svgRect.width;
             const scaleY = viewBox.height / svgRect.height;
             
             // 将DOM坐标转换为SVG坐标
             const toSVGCoords = (element) => {
                 const rect = element.getBoundingClientRect();
                 const centerX = rect.left + rect.width / 2;
                 const centerY = rect.top + rect.height / 2;
                 return {
                     x: (centerX - floorRect.left) * scaleX,
                     y: (centerY - floorRect.top) * scaleY
                 };
             };
             
             // 获取所有引脚的SVG坐标
             const topPinCoords = topPins.map(toSVGCoords);
             const bottomPinCoords = bottomPins.map(toSVGCoords);
             const leftPinCoords = leftPins.map(toSVGCoords);
             const rightPinCoords = rightPins.map(toSVGCoords);
             
             // 计算芯片的实际尺寸和中心
             const chipRect = chipPackage.getBoundingClientRect();
             const chipCenterX = (chipRect.left + chipRect.width / 2 - floorRect.left) * scaleX;
             const chipCenterY = (chipRect.top + chipRect.height / 2 - floorRect.top) * scaleY;
             const chipWidthSVG = chipRect.width * scaleX;
             const chipHeightSVG = chipRect.height * scaleY;
             
             // 基于芯片尺寸计算间距参数
             const horizontalSpacing = chipWidthSVG * 0.5; // 水平转折距离为芯片宽度的50%
             const verticalSpacing = chipHeightSVG * 0.6; // 垂直转折距离为芯片高度的60%
             
             // 清空现有路径，重新绘制
             svg.innerHTML = '';
             
             // 创建SVG元素的辅助函数
             const createPath = (d, className = 'trace-path', strokeWidth = 1.5, opacity = 1) => {
                 const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                 path.setAttribute('d', d);
                 path.setAttribute('class', className);
                 path.setAttribute('stroke-width', strokeWidth);
                 if (opacity < 1) path.setAttribute('opacity', opacity);
                 return path;
             };
             
             const createCircle = (cx, cy, r, fill, opacity = 1, stroke = null, strokeWidth = 1) => {
                 const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                 circle.setAttribute('cx', cx);
                 circle.setAttribute('cy', cy);
                 circle.setAttribute('r', r);
                 circle.setAttribute('fill', fill);
                 if (opacity < 1) circle.setAttribute('opacity', opacity);
                 if (stroke) {
                     circle.setAttribute('stroke', stroke);
                     circle.setAttribute('stroke-width', strokeWidth);
                 }
                 return circle;
             };
             
            // 获取芯片输入框的位置，用于确定推荐问题节点的位置
            const searchWrapper = chipPackage?.querySelector('.search-wrapper');
            let searchWrapperY = chipCenterY;
            if (searchWrapper) {
                const searchRect = searchWrapper.getBoundingClientRect();
                searchWrapperY = (searchRect.top + searchRect.height / 2 - floorRect.top) * scaleY;
            }
            
            // 从侧边栏到芯片左侧引脚的走线 - 对称实现，与右侧风格一致
            // 左侧推荐问题列表
            const leftQuestions = [
                '查找GD25Q64ESIGR的详细参数',
                '基于产品需求，生成BOM',
                'R26110692的内阻是多少'
            ];
            
            leftPinCoords.forEach((pin, i) => {
                const startX = 0;
                // 完全对称于右侧：bendX1 对应右侧的 bendX1，bendX2 对应右侧的 bendX2
                const bendX1 = pin.x - horizontalSpacing * 0.2; // 从引脚向左的第一个拐点
                const bendX2 = pin.x - horizontalSpacing * 0.4 - i * (horizontalSpacing * 0.1); // 第二个拐点，对称于右侧
                const isActive = i === 0;
                // 与右侧完全相同的垂直偏移逻辑
                const offsetY = (i - 1) * (verticalSpacing * 0.25);
                
                // 左侧连线：从右往左展开，完全对称于右侧（右侧从左往右）
                // 右侧：M${pin.x} ${pin.y} L${bendX1} ${pin.y} L${bendX2} ${pin.y + offsetY} L${endX} ${pin.y + offsetY}
                // 左侧：M${pin.x} ${pin.y} L${bendX1} ${pin.y} L${bendX2} ${pin.y + offsetY} L${startX} ${pin.y + offsetY}
                svg.appendChild(createPath(
                    `M${pin.x} ${pin.y} L${bendX1} ${pin.y} L${bendX2} ${pin.y + offsetY} L${startX} ${pin.y + offsetY}`,
                    isActive ? 'trace-path active' : 'trace-path'
                ));
                
                svg.appendChild(createCircle(pin.x, pin.y, isActive ? 4 : 3, isActive ? '#6DD5E8' : '#CBD5E1', 0.9, isActive ? '#fff' : null, 1.5));
                svg.appendChild(createCircle(bendX2, pin.y + offsetY, isActive ? 3.5 : 2.5, isActive ? '#6DD5E8' : '#CBD5E1', 0.8));
                svg.appendChild(createCircle(startX, pin.y + offsetY, isActive ? 3.5 : 2.5, isActive ? '#6DD5E8' : '#CBD5E1', 0.8));
                
                // 在左侧连线上添加推荐问题节点（气泡样式）- 完全复用右侧的逻辑
                if (i < leftQuestions.length) {
                    const questionText = leftQuestions[i];
                    // 问题节点的Y坐标基于连线的实际位置（拐角后的Y坐标，跟随 offsetY）- 与右侧相同
                    const questionY = pin.y + offsetY;
                    // 气泡位置：在拐角点 bendX2 左侧（对应右侧的 bendX2 右侧）
                    const questionX = bendX2 - 15; // 气泡在拐角点左侧
                    const branchX = bendX2; // 分支从拐角点 bendX2 开始（与右侧相同）
                    
                    // 从主线拐角点连接到问题节点的线条（带拐角）- 完全对称于右侧
                    svg.appendChild(createPath(
                        `M${branchX} ${questionY} L${questionX - 110} ${questionY} L${questionX - 110} ${questionY}`,
                        'trace-path',
                        1.5,
                        0.8
                    ));
                    
                    // 问题气泡节点 - 完全复用右侧的样式
                    const questionGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    questionGroup.setAttribute('class', 'question-node');
                    questionGroup.setAttribute('style', 'cursor: pointer;');
                    
                    // 计算文本宽度（增加宽度，确保文字不超出）- 与右侧相同
                    const textWidth = Math.max(questionText.length * 8 + 30, 160);
                    const textHeight = 32;
                    
                    // 气泡背景
                    const bubbleRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    bubbleRect.setAttribute('x', questionX - textWidth);
                    bubbleRect.setAttribute('y', questionY - textHeight / 2);
                    bubbleRect.setAttribute('width', textWidth);
                    bubbleRect.setAttribute('height', textHeight);
                    bubbleRect.setAttribute('rx', '16');
                    bubbleRect.setAttribute('fill', '#FFFFFF');
                    bubbleRect.setAttribute('stroke', '#6DD5E8');
                    bubbleRect.setAttribute('stroke-width', '1.5');
                    bubbleRect.setAttribute('filter', 'drop-shadow(0 2px 8px rgba(109, 213, 232, 0.15))');
                    questionGroup.appendChild(bubbleRect);
                    
                    // 文本
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', questionX - textWidth / 2);
                    text.setAttribute('y', questionY);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('dominant-baseline', 'middle');
                    text.setAttribute('font-size', '11');
                    text.setAttribute('fill', '#334155');
                    text.setAttribute('font-weight', '500');
                    text.textContent = questionText;
                    questionGroup.appendChild(text);
                    
                    // 连接点（在分支线上）
                    svg.appendChild(createCircle(questionX - 110, questionY, 3, '#6DD5E8', 0.9));
                    
                    svg.appendChild(questionGroup);
                }
                
                // 添加更多装饰性分支走线 - 对称于右侧
                const branchY = pin.y + offsetY + (i - 1.5) * (verticalSpacing * 0.1);
                svg.appendChild(createPath(
                    `M${bendX2} ${pin.y + offsetY} L${bendX2 - horizontalSpacing * 0.08} ${branchY} L${bendX2 - horizontalSpacing * 0.15} ${branchY}`,
                    'trace-path', 1, 0.35
                ));
                svg.appendChild(createCircle(bendX2 - horizontalSpacing * 0.15, branchY, 2, '#CBD5E1', 0.5));
                
                // 额外的次级分支
                if (i === 2) {
                    svg.appendChild(createPath(
                        `M${bendX2 - horizontalSpacing * 0.08} ${branchY} L${bendX2 - horizontalSpacing * 0.08} ${branchY + 40} L${bendX2 - horizontalSpacing * 0.12} ${branchY + 60}`,
                        'trace-path', 1, 0.25
                    ));
                }
            });
             
             // 从芯片顶部引脚到上方按钮和页面顶部 - 基于芯片高度计算间距
             const upButtonY = 80;
             const centerTopIndex = Math.floor(topPinCoords.length / 2);
             
             topPinCoords.forEach((pin, i) => {
                 const isCenter = i === centerTopIndex;
                 const bendY1 = pin.y - verticalSpacing * 0.35;
                 const bendY2 = pin.y - verticalSpacing * 0.65;
                 
                 if (isCenter) {
                     // 中心主走线，穿过按钮
                     svg.appendChild(createPath(`M${pin.x} ${pin.y} L${pin.x} ${upButtonY + 22}`, 'trace-path active', 2.5));
                     svg.appendChild(createPath(`M${pin.x} ${upButtonY - 22} L${pin.x} 0`, 'trace-path active', 2.5));
                 } else {
                     // 其他引脚的分支走线 - 基于芯片宽度的偏移
                     const offsetX = (i - centerTopIndex) * (chipWidthSVG * 0.08);
                     svg.appendChild(createPath(
                         `M${pin.x} ${pin.y} L${pin.x} ${bendY1} L${pin.x + offsetX} ${bendY2} L${pin.x + offsetX} 0`,
                         'trace-path',
                         1.5,
                         0.7
                     ));
                     
                     // 添加更多装饰性分支
                     const branchX = pin.x + offsetX * 0.5;
                     const branchY = bendY1 - verticalSpacing * 0.12;
                     svg.appendChild(createPath(
                         `M${pin.x} ${bendY1} L${branchX} ${branchY} L${branchX + chipWidthSVG * 0.06} ${branchY}`,
                         'trace-path', 1, 0.3
                     ));
                     svg.appendChild(createCircle(branchX + chipWidthSVG * 0.06, branchY, 2, '#CBD5E1', 0.4));
                     
                     // 次级分支
                     if (Math.abs(i - centerTopIndex) === 2) {
                         svg.appendChild(createPath(
                             `M${branchX} ${branchY} L${branchX} ${branchY - 40} L${branchX - 30} ${branchY - 70}`,
                             'trace-path', 1, 0.25
                         ));
                     }
                 }
                 
                 // 引脚连接点
                 svg.appendChild(createCircle(pin.x, pin.y, isCenter ? 4 : 3, isCenter ? '#6DD5E8' : '#CBD5E1', 0.9, isCenter ? '#fff' : null, 1.5));
             });
             
             // 上方楼层切换按钮
             const centerTopPin = topPinCoords[centerTopIndex];
             const upButtonGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
             upButtonGroup.setAttribute('class', 'floor-node');
             upButtonGroup.setAttribute('data-floor', 'up');
             upButtonGroup.setAttribute('data-nav', 'to-tutorial');
             upButtonGroup.innerHTML = `
                 <circle cx="${centerTopPin.x}" cy="${upButtonY}" r="20" fill="#FFFFFF" stroke="#6DD5E8" stroke-width="2.5"/>
                 <circle cx="${centerTopPin.x}" cy="${upButtonY}" r="15" fill="none" stroke="#CBD5E1" stroke-width="1" stroke-dasharray="2,2"/>
                 <path d="M${centerTopPin.x - 5} ${upButtonY + 3} L${centerTopPin.x} ${upButtonY - 2} L${centerTopPin.x + 5} ${upButtonY + 3}" 
                       fill="none" stroke="#6DD5E8" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                 <circle cx="${centerTopPin.x}" cy="${upButtonY}" r="4" fill="#6DD5E8"/>
                 <!-- 气泡放到按钮下方，避免顶部溢出 -->
                 <g class="floor-node-bubble">
                   <rect class="floor-node-bubble-bg" x="${centerTopPin.x - 42}" y="${upButtonY + 30}" width="84" height="28" rx="10" />
                   <text class="floor-node-label" x="${centerTopPin.x}" y="${upButtonY + 44}" text-anchor="middle" dominant-baseline="middle">查看教程</text>
                 </g>
             `;
             svg.appendChild(upButtonGroup);
             
             // 从芯片底部引脚到下方按钮和页面底部 - 基于芯片高度计算间距
             const downButtonY = viewBox.height - 80;
             const centerBottomIndex = Math.floor(bottomPinCoords.length / 2);
             
             bottomPinCoords.forEach((pin, i) => {
                 const isCenter = i === centerBottomIndex;
                 const bendY1 = pin.y + verticalSpacing * 0.35;
                 const bendY2 = pin.y + verticalSpacing * 0.65;
                 
                 if (isCenter) {
                     // 中心主走线，穿过按钮
                     svg.appendChild(createPath(`M${pin.x} ${pin.y} L${pin.x} ${downButtonY - 22}`, 'trace-path active', 2.5));
                     svg.appendChild(createPath(`M${pin.x} ${downButtonY + 22} L${pin.x} ${viewBox.height}`, 'trace-path active', 2.5));
                 } else {
                     // 其他引脚的分支走线 - 基于芯片宽度的偏移
                     const offsetX = (i - centerBottomIndex) * (chipWidthSVG * 0.08);
                     svg.appendChild(createPath(
                         `M${pin.x} ${pin.y} L${pin.x} ${bendY1} L${pin.x + offsetX} ${bendY2} L${pin.x + offsetX} ${viewBox.height}`,
                         'trace-path',
                         1.5,
                         0.7
                     ));
                     
                     // 添加更多装饰性分支
                     const branchX = pin.x + offsetX * 0.5;
                     const branchY = bendY1 + verticalSpacing * 0.12;
                     svg.appendChild(createPath(
                         `M${pin.x} ${bendY1} L${branchX} ${branchY} L${branchX + chipWidthSVG * 0.06} ${branchY}`,
                         'trace-path', 1, 0.3
                     ));
                     svg.appendChild(createCircle(branchX + chipWidthSVG * 0.06, branchY, 2, '#CBD5E1', 0.4));
                     
                     // 次级分支
                     if (Math.abs(i - centerBottomIndex) === 2) {
                         svg.appendChild(createPath(
                             `M${branchX} ${branchY} L${branchX} ${branchY + 40} L${branchX - 30} ${branchY + 70}`,
                             'trace-path', 1, 0.25
                         ));
                     }
                 }
                 
                 // 引脚连接点
                 svg.appendChild(createCircle(pin.x, pin.y, isCenter ? 4 : 3, isCenter ? '#6DD5E8' : '#CBD5E1', 0.9, isCenter ? '#fff' : null, 1.5));
             });
             
            // 下方楼层切换按钮
            const centerBottomPin = bottomPinCoords[centerBottomIndex];
            const downButtonGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            downButtonGroup.setAttribute('class', 'floor-node');
            downButtonGroup.setAttribute('data-nav', 'to-practices');
             downButtonGroup.innerHTML = `
                 <circle cx="${centerBottomPin.x}" cy="${downButtonY}" r="20" fill="#FFFFFF" stroke="#6DD5E8" stroke-width="2.5"/>
                 <circle cx="${centerBottomPin.x}" cy="${downButtonY}" r="15" fill="none" stroke="#CBD5E1" stroke-width="1" stroke-dasharray="2,2"/>
                 <path d="M${centerBottomPin.x - 5} ${downButtonY - 3} L${centerBottomPin.x} ${downButtonY + 2} L${centerBottomPin.x + 5} ${downButtonY - 3}" 
                       fill="none" stroke="#6DD5E8" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                 <circle cx="${centerBottomPin.x}" cy="${downButtonY}" r="4" fill="#6DD5E8"/>
                 <!-- 气泡放到按钮上方，避免底部溢出 -->
                 <g class="floor-node-bubble">
                   <rect class="floor-node-bubble-bg" x="${centerBottomPin.x - 42}" y="${downButtonY - 58}" width="84" height="28" rx="10" />
                   <text class="floor-node-label" x="${centerBottomPin.x}" y="${downButtonY - 44}" text-anchor="middle" dominant-baseline="middle">最佳实践</text>
                 </g>
             `;
             svg.appendChild(downButtonGroup);
             
            // 从芯片右侧引脚到页面右侧 - 基于芯片宽度计算间距
            // 右侧推荐问题列表
            const rightQuestions = [
                '品牌为 infineon，内阻小于 100mΩ的mos',
                'R26112362推荐同规格产品',
                'SCT1000N170弥勒平台怎么理解'
            ];
            
            rightPinCoords.forEach((pin, i) => {
                const bendX1 = pin.x + horizontalSpacing * 0.2;
                const bendX2 = pin.x + horizontalSpacing * 0.4 + i * (horizontalSpacing * 0.1);
                const endX = viewBox.width;
                const isActive = i === 1;
                // 调整垂直偏移，让问题分布更均匀：上面的往上，下面的往下（与左侧对称）
                const offsetY = (i - 1) * (verticalSpacing * 0.25); // 增加间距，让分布更均匀
                
                svg.appendChild(createPath(
                    `M${pin.x} ${pin.y} L${bendX1} ${pin.y} L${bendX2} ${pin.y + offsetY} L${endX} ${pin.y + offsetY}`,
                    isActive ? 'trace-path active' : 'trace-path'
                ));
                
                svg.appendChild(createCircle(pin.x, pin.y, isActive ? 4 : 3, isActive ? '#6DD5E8' : '#CBD5E1', 0.9, isActive ? '#fff' : null, 1.5));
                svg.appendChild(createCircle(bendX2, pin.y + offsetY, isActive ? 3.5 : 2.5, isActive ? '#6DD5E8' : '#CBD5E1', 0.8));
                
                // 在右侧连线上添加推荐问题节点（气泡样式）- 连接到主线的拐角点
                if (i < rightQuestions.length) {
                    const questionText = rightQuestions[i];
                    // 问题节点的Y坐标基于连线的实际位置（拐角后的Y坐标，跟随 offsetY）
                    const questionY = pin.y + offsetY;
                    // 气泡位置：在拐角点 bendX2 右侧，留出连接空间
                    const questionX = bendX2 + 15; // 气泡在拐角点右侧
                    const branchX = bendX2; // 分支从拐角点 bendX2 开始
                    
                    // 从主线拐角点连接到问题节点的线条（带拐角）
                    svg.appendChild(createPath(
                        `M${branchX} ${questionY} L${questionX + 110} ${questionY} L${questionX + 110} ${questionY}`,
                        'trace-path',
                        1.5,
                        0.8
                    ));
                    
                    // 问题气泡节点
                    const questionGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    questionGroup.setAttribute('class', 'question-node');
                    questionGroup.setAttribute('style', 'cursor: pointer;');
                    
                    // 计算文本宽度（增加宽度，确保文字不超出）
                    const textWidth = Math.max(questionText.length * 8 + 30, 160);
                    const textHeight = 32;
                    
                    // 气泡背景
                    const bubbleRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    bubbleRect.setAttribute('x', questionX);
                    bubbleRect.setAttribute('y', questionY - textHeight / 2);
                    bubbleRect.setAttribute('width', textWidth);
                    bubbleRect.setAttribute('height', textHeight);
                    bubbleRect.setAttribute('rx', '16');
                    bubbleRect.setAttribute('fill', '#FFFFFF');
                    bubbleRect.setAttribute('stroke', '#6DD5E8');
                    bubbleRect.setAttribute('stroke-width', '1.5');
                    bubbleRect.setAttribute('filter', 'drop-shadow(0 2px 8px rgba(109, 213, 232, 0.15))');
                    questionGroup.appendChild(bubbleRect);
                    
                    // 文本
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', questionX + textWidth / 2);
                    text.setAttribute('y', questionY);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('dominant-baseline', 'middle');
                    text.setAttribute('font-size', '11');
                    text.setAttribute('fill', '#334155');
                    text.setAttribute('font-weight', '500');
                    text.textContent = questionText;
                    questionGroup.appendChild(text);
                    
                    // 连接点（在分支线上）
                    svg.appendChild(createCircle(questionX + 110, questionY, 3, '#6DD5E8', 0.9));
                    
                    svg.appendChild(questionGroup);
                }
                
                // 添加更多装饰性分支走线
                const branchY = pin.y + offsetY + (i - 1.5) * (verticalSpacing * 0.1);
                svg.appendChild(createPath(
                    `M${bendX2} ${pin.y + offsetY} L${bendX2 + horizontalSpacing * 0.08} ${branchY} L${bendX2 + horizontalSpacing * 0.15} ${branchY}`,
                    'trace-path', 1, 0.35
                ));
                svg.appendChild(createCircle(bendX2 + horizontalSpacing * 0.15, branchY, 2, '#CBD5E1', 0.5));
                
                // 额外的次级分支
                if (i === 2) {
                    svg.appendChild(createPath(
                        `M${bendX2 + horizontalSpacing * 0.08} ${branchY} L${bendX2 + horizontalSpacing * 0.08} ${branchY + 40} L${bendX2 + horizontalSpacing * 0.12} ${branchY + 60}`,
                        'trace-path', 1, 0.25
                    ));
                }
            });
             
             // 添加装饰性背景走线网络
             addDecorativeTraces(svg, viewBox, chipCenterX, chipCenterY, chipWidthSVG, chipHeightSVG);
             
             // 重新绑定按钮事件
             bindFloorNodeEvents(floor);
             
             // 重新初始化视觉效果
             setTimeout(() => {
                 if (floor.classList.contains('floor-workbench')) {
                     initWorkbenchEffects();
                 } else if (floor.classList.contains('floor-tutorial')) {
                     initTutorialEffects();
                 } else if (floor.classList.contains('floor-practices')) {
                     initPracticesEffects();
                 }
             }, 300);
         }
         
         // 添加大量装饰性背景走线
         function addDecorativeTraces(svg, viewBox, centerX, centerY, chipWidth, chipHeight) {
             const createPath = (d, opacity = 0.25, strokeWidth = 1, dashArray = null) => {
                 const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                 path.setAttribute('d', d);
                 path.setAttribute('class', 'trace-path');
                 path.setAttribute('stroke-width', strokeWidth);
                 path.setAttribute('opacity', opacity);
                 if (dashArray) path.setAttribute('stroke-dasharray', dashArray);
                 return path;
             };
             
             const createCircle = (cx, cy, r = 2, opacity = 0.3) => {
                 const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                 circle.setAttribute('cx', cx);
                 circle.setAttribute('cy', cy);
                 circle.setAttribute('r', r);
                 circle.setAttribute('fill', '#CBD5E1');
                 circle.setAttribute('opacity', opacity);
                 return circle;
             };
             
             // 四角密集装饰走线网络
             // 左上角 - 多层走线
             for (let i = 0; i < 5; i++) {
                 const offsetY = 60 + i * 25;
                 svg.appendChild(createPath(`M20 ${offsetY} L${80 + i * 15} ${offsetY} L${110 + i * 15} ${offsetY + 30} L${180 + i * 20} ${offsetY + 30}`, 0.2));
                 svg.appendChild(createCircle(80 + i * 15, offsetY, 2, 0.25));
             }
             // 左上角垂直走线
             for (let i = 0; i < 3; i++) {
                 const offsetX = 60 + i * 40;
                 svg.appendChild(createPath(`M${offsetX} 40 L${offsetX} 100 L${offsetX + 20} 130 L${offsetX + 20} 180`, 0.18));
             }
             
             // 右上角 - 多层走线
             for (let i = 0; i < 5; i++) {
                 const offsetY = 60 + i * 25;
                 svg.appendChild(createPath(`M${viewBox.width - 20} ${offsetY} L${viewBox.width - 80 - i * 15} ${offsetY} L${viewBox.width - 110 - i * 15} ${offsetY + 30} L${viewBox.width - 180 - i * 20} ${offsetY + 30}`, 0.2));
                 svg.appendChild(createCircle(viewBox.width - 80 - i * 15, offsetY, 2, 0.25));
             }
             // 右上角垂直走线
             for (let i = 0; i < 3; i++) {
                 const offsetX = viewBox.width - 60 - i * 40;
                 svg.appendChild(createPath(`M${offsetX} 40 L${offsetX} 100 L${offsetX - 20} 130 L${offsetX - 20} 180`, 0.18));
             }
             
             // 左下角 - 多层走线
             for (let i = 0; i < 5; i++) {
                 const offsetY = viewBox.height - 60 - i * 25;
                 svg.appendChild(createPath(`M20 ${offsetY} L${80 + i * 15} ${offsetY} L${110 + i * 15} ${offsetY - 30} L${180 + i * 20} ${offsetY - 30}`, 0.2));
                 svg.appendChild(createCircle(80 + i * 15, offsetY, 2, 0.25));
             }
             // 左下角垂直走线
             for (let i = 0; i < 3; i++) {
                 const offsetX = 60 + i * 40;
                 svg.appendChild(createPath(`M${offsetX} ${viewBox.height - 40} L${offsetX} ${viewBox.height - 100} L${offsetX + 20} ${viewBox.height - 130} L${offsetX + 20} ${viewBox.height - 180}`, 0.18));
             }
             
             // 右下角 - 多层走线
             for (let i = 0; i < 5; i++) {
                 const offsetY = viewBox.height - 60 - i * 25;
                 svg.appendChild(createPath(`M${viewBox.width - 20} ${offsetY} L${viewBox.width - 80 - i * 15} ${offsetY} L${viewBox.width - 110 - i * 15} ${offsetY - 30} L${viewBox.width - 180 - i * 20} ${offsetY - 30}`, 0.2));
                 svg.appendChild(createCircle(viewBox.width - 80 - i * 15, offsetY, 2, 0.25));
             }
             // 右下角垂直走线
             for (let i = 0; i < 3; i++) {
                 const offsetX = viewBox.width - 60 - i * 40;
                 svg.appendChild(createPath(`M${offsetX} ${viewBox.height - 40} L${offsetX} ${viewBox.height - 100} L${offsetX - 20} ${viewBox.height - 130} L${offsetX - 20} ${viewBox.height - 180}`, 0.18));
             }
             
             // 中间区域虚线网络
             const dashPatterns = ['5,3', '8,4', '3,2'];
             for (let i = 0; i < 6; i++) {
                 const angle = (i * 60) * Math.PI / 180;
                 const startX = centerX + Math.cos(angle) * chipWidth * 0.8;
                 const startY = centerY + Math.sin(angle) * chipHeight * 0.8;
                 const endX = centerX + Math.cos(angle) * chipWidth * 1.5;
                 const endY = centerY + Math.sin(angle) * chipHeight * 1.8;
                 const midX = (startX + endX) / 2;
                 const midY = (startY + endY) / 2;
                 
                 svg.appendChild(createPath(
                     `M${startX} ${startY} L${midX} ${midY} L${endX} ${endY}`,
                     0.15, 1, dashPatterns[i % 3]
                 ));
                 svg.appendChild(createCircle(midX, midY, 1.5, 0.2));
             }
             
             // 添加交叉网格走线
             for (let i = 0; i < 4; i++) {
                 const x = 150 + i * (viewBox.width - 300) / 3;
                 if (Math.abs(x - centerX) > chipWidth * 0.7) {
                     svg.appendChild(createPath(`M${x} 50 L${x} ${viewBox.height - 50}`, 0.12, 0.8));
                 }
             }
             for (let i = 0; i < 4; i++) {
                 const y = 150 + i * (viewBox.height - 300) / 3;
                 if (Math.abs(y - centerY) > chipHeight * 0.8) {
                     svg.appendChild(createPath(`M50 ${y} L${viewBox.width - 50} ${y}`, 0.12, 0.8));
                 }
             }
             
             // 随机装饰性节点和短走线
             for (let i = 0; i < 30; i++) {
                 const x = 80 + Math.random() * (viewBox.width - 160);
                 const y = 80 + Math.random() * (viewBox.height - 160);
                 // 避开芯片中心区域
                 if (Math.abs(x - centerX) > chipWidth * 0.6 || Math.abs(y - centerY) > chipHeight * 0.7) {
                     svg.appendChild(createCircle(x, y, 1.5, 0.2));
                     // 添加短走线
                     if (i % 3 === 0) {
                         const angle = Math.random() * Math.PI * 2;
                         const len = 20 + Math.random() * 30;
                         svg.appendChild(createPath(
                             `M${x} ${y} L${x + Math.cos(angle) * len} ${y + Math.sin(angle) * len}`,
                             0.15, 0.8
                         ));
                     }
                 }
             }
         }
         
         // 绑定楼层切换按钮事件
         function bindFloorNodeEvents(root = document) {
             root.querySelectorAll('.floor-node').forEach(node => {
                 node.addEventListener('click', function() {
                     const nav = this.getAttribute('data-nav');
                    if (nav === 'to-tutorial') {
                        setActiveFloor('tutorial');
                        // 进入新页面后重绘一次，保证位置准确
                        requestAnimationFrame(() => {
                            renderTutorialFloor();
                            setTimeout(() => {
                                initTutorialEffects();
                            }, 400);
                        });
                        return;
                    }
                   if (nav === 'to-practices') {
                       setActiveFloor('practices');
                       // 进入新页面后重绘一次，保证位置准确
                       requestAnimationFrame(() => {
                           renderPracticesFloor();
                           setTimeout(() => {
                               initPracticesEffects();
                           }, 400);
                       });
                       return;
                   }
                   if (nav === 'to-workbench') {
                       setActiveFloor('workbench');
                       setTimeout(() => {
                           initWorkbenchEffects();
                       }, 400);
                       return;
                   }

                    const floor = this.getAttribute('data-floor');
                     if (floor) console.log('准备切换到楼层:', floor);
                     
                     this.style.transform = 'scale(0.9)';
                     setTimeout(() => {
                         this.style.transform = '';
                     }, 200);
                 });
             });
         }
         
         // ========== 动画配置参数（可在此处调整所有动画节奏）==========
         // 提示：所有时长单位为毫秒（ms），CSS动画时长单位为秒（s）
         // 默认值已设置为原来的3倍（放慢3倍），可根据需要调整
         const ANIMATION_CONFIG = {
             // CSS动画时长（秒）
             breathingGlowDuration: 9,        // 呼吸灯动画时长（原3s，现9s）
             currentFlowPulseDuration: 3.6,   // 电流脉冲动画时长（原1.2s，现3.6s）
             
             // JavaScript定时器时长（毫秒）
             phase1BreathingDuration: 6000,  // 阶段1：随机激活线条时长（原2000ms，现6000ms）
             phase2CurrentFlowDuration: 3600, // 阶段2：电流传导时长（原1200ms，现3600ms）
             phase2Delay: 6000,               // 阶段2延迟开始时间（原2000ms，现6000ms）
             cycleInterval: 12000,            // 完整循环间隔（原4000ms，现12000ms）
             
             // 细节动画时长（毫秒）
             pathStaggerDelay: 60,            // 线条错开延迟（原20ms，现60ms）
             
             // 初始化延迟（毫秒）
             initDelay: 1500,                 // 初始化延迟（原500ms，现1500ms）
             resizeDelay: 900                 // 窗口大小改变后延迟（原300ms，现900ms）
         };
         
         // ========== 通用视觉效果系统 ==========
         
         /**
          * 有节奏的动效系统：随机激活线条 → 同时向外传导电流
          * @param {SVGElement} svg - SVG容器
          * @param {number} centerX - 中心X坐标
          * @param {number} centerY - 中心Y坐标
          */
         function initRhythmicEffects(svg, centerX, centerY) {
             // 应用CSS动画时长到SVG元素
             svg.style.setProperty('--breathing-duration', `${ANIMATION_CONFIG.breathingGlowDuration}s`);
             svg.style.setProperty('--current-flow-duration', `${ANIMATION_CONFIG.currentFlowPulseDuration}s`);
             if (!svg) return;
             
             // 获取所有主要线条（排除装饰性线条）
             const allPaths = Array.from(svg.querySelectorAll('.trace-path'));
             const mainPaths = allPaths.filter(path => {
                 const opacity = parseFloat(path.getAttribute('opacity') || '1');
                 const strokeWidth = parseFloat(path.getAttribute('stroke-width') || '1.5');
                 // 放宽筛选条件：opacity >= 0.4 且 strokeWidth >= 1.2，确保教程页和最佳实践页的线条也能被选中
                 return opacity >= 0.4 && strokeWidth >= 1.2;
             });
             
             if (mainPaths.length === 0) return;
             
             // 按方向分组线条（四个方向：上、下、左、右）
             const pathsByDirection = {
                 top: [],
                 bottom: [],
                 left: [],
                 right: []
             };
             
             mainPaths.forEach(path => {
                 const d = path.getAttribute('d') || '';
                 // 尝试匹配路径起点（M命令）
                 let match = d.match(/M\s*([\d.]+)\s*([\d.]+)/);
                 
                 // 如果没找到M命令，尝试匹配第一个坐标点
                 if (!match) {
                     const coordMatch = d.match(/([\d.]+)\s+([\d.]+)/);
                     if (coordMatch) {
                         match = [null, coordMatch[1], coordMatch[2]];
                     }
                 }
                 
                 if (match) {
                     const startX = parseFloat(match[1]);
                     const startY = parseFloat(match[2]);
                     
                     // 判断方向
                     const dx = startX - centerX;
                     const dy = startY - centerY;
                     const absDx = Math.abs(dx);
                     const absDy = Math.abs(dy);
                     
                     // 如果距离中心太近，根据路径整体方向判断
                     if (absDx < 50 && absDy < 50) {
                         // 尝试从路径的其他点判断方向
                         const allCoords = d.match(/([\d.]+)\s+([\d.]+)/g);
                         if (allCoords && allCoords.length > 1) {
                             const lastCoord = allCoords[allCoords.length - 1].split(/\s+/);
                             const endX = parseFloat(lastCoord[0]);
                             const endY = parseFloat(lastCoord[1]);
                             const endDx = endX - centerX;
                             const endDy = endY - centerY;
                             
                             if (Math.abs(endDy) > Math.abs(endDx)) {
                                 if (endDy < 0) pathsByDirection.top.push(path);
                                 else pathsByDirection.bottom.push(path);
                             } else {
                                 if (endDx < 0) pathsByDirection.left.push(path);
                                 else pathsByDirection.right.push(path);
                             }
                         } else {
                             // 无法判断方向，放入最近的组
                             if (absDy > absDx) {
                                 if (dy < 0) pathsByDirection.top.push(path);
                                 else pathsByDirection.bottom.push(path);
                             } else {
                                 if (dx < 0) pathsByDirection.left.push(path);
                                 else pathsByDirection.right.push(path);
                             }
                         }
                     } else {
                         // 正常判断方向
                         if (absDy > absDx) {
                             // 垂直方向
                             if (dy < 0) pathsByDirection.top.push(path);
                             else pathsByDirection.bottom.push(path);
                         } else {
                             // 水平方向
                             if (dx < 0) pathsByDirection.left.push(path);
                             else pathsByDirection.right.push(path);
                         }
                     }
                 } else {
                     // 无法解析路径，放入默认组（底部）
                     pathsByDirection.bottom.push(path);
                 }
             });
             
             // 阶段1：随机激活线条（呼吸灯效果）
             function phase1_RandomBreathing() {
                 // 清除所有效果
                 mainPaths.forEach(path => path.classList.remove('breathing', 'current-flow'));
                 
                 // 每个方向随机激活 2-3 条线条
                 Object.keys(pathsByDirection).forEach(direction => {
                     const paths = pathsByDirection[direction];
                     if (paths.length === 0) return;
                     
                     const count = Math.min(2 + Math.floor(Math.random() * 2), paths.length);
                     const shuffled = [...paths].sort(() => Math.random() - 0.5);
                     
                     shuffled.slice(0, count).forEach(path => {
                         path.classList.add('breathing');
                     });
                 });
             }
             
             // 阶段2：同时向外传导电流
             function phase2_CurrentFlow() {
                 // 清除呼吸灯效果
                 mainPaths.forEach(path => path.classList.remove('breathing'));
                 
                 // 所有主要线条同时激活电流效果
                 mainPaths.forEach((path, index) => {
                     setTimeout(() => {
                         path.classList.add('current-flow');
                     }, index * ANIMATION_CONFIG.pathStaggerDelay); // 稍微错开，形成波浪效果
                 });
                 
                 // 清除电流效果
                 setTimeout(() => {
                     mainPaths.forEach(path => path.classList.remove('current-flow'));
                 }, ANIMATION_CONFIG.phase2CurrentFlowDuration);
             }
             
             // 执行动效循环
             function runCycle() {
                 // 阶段1：随机激活线条
                 phase1_RandomBreathing();
                 
                 // 阶段2：电流传导（延迟后开始）
                 setTimeout(() => {
                     phase2_CurrentFlow();
                 }, ANIMATION_CONFIG.phase2Delay);
             }
             
             // 立即执行第一次
             runCycle();
             
             // 循环执行
             return setInterval(runCycle, ANIMATION_CONFIG.cycleInterval);
         }
         
         // ========== 页面加载和窗口大小改变时更新走线 ==========
         // 存储各页面的定时器
         const effectIntervals = {
             workbench: null,
             tutorial: null,
             practices: null
         };
         
         /**
          * 通用特效初始化函数
          * @param {string} floorSelector - 楼层选择器
          * @param {string} centerElementSelector - 中心元素选择器（用于计算中心点）
          * @param {string} pageKey - 页面标识（用于存储定时器）
          */
         function initFloorEffects(floorSelector, centerElementSelector, pageKey) {
             const floor = document.querySelector(floorSelector);
             const svg = floor?.querySelector('.pcb-layer-svg');
             const centerElement = floor?.querySelector(centerElementSelector);
             
             if (!svg || !centerElement) return;
             
             // 清除之前的定时器
             if (effectIntervals[pageKey]) {
                 clearInterval(effectIntervals[pageKey]);
                 effectIntervals[pageKey] = null;
             }
             
             // 计算中心位置
             const centerRect = centerElement.getBoundingClientRect();
             const floorRect = floor.getBoundingClientRect();
             const viewBox = svg.viewBox.baseVal;
             const svgRect = svg.getBoundingClientRect();
             const scaleX = viewBox.width / svgRect.width;
             const scaleY = viewBox.height / svgRect.height;
             
             const centerX = (centerRect.left + centerRect.width / 2 - floorRect.left) * scaleX;
             const centerY = (centerRect.top + centerRect.height / 2 - floorRect.top) * scaleY;
             
             // 初始化有节奏的动效系统
             effectIntervals[pageKey] = initRhythmicEffects(svg, centerX, centerY);
         }
         
         // 工作台页面特效初始化
         function initWorkbenchEffects() {
             initFloorEffects('.floor-workbench', '.chip-package', 'workbench');
         }
         
         // 教程页面特效初始化
         function initTutorialEffects() {
             initFloorEffects('.floor-tutorial', '.tutorial-card', 'tutorial');
         }
         
         // 最佳实践页面特效初始化
         function initPracticesEffects() {
             initFloorEffects('.floor-practices', '.practices-container', 'practices');
         }
         
         window.addEventListener('load', () => {
             updateTraces();
             renderTutorialFloor();
             renderPracticesFloor();
             // 初始化所有页面的视觉效果
             setTimeout(() => {
                 initWorkbenchEffects();
                 initTutorialEffects();
                 initPracticesEffects();
             }, ANIMATION_CONFIG.initDelay); // 延迟确保SVG已渲染
         });
         window.addEventListener('resize', () => {
             updateTraces();
             renderTutorialFloor();
             renderPracticesFloor();
             // 重新初始化所有页面的视觉效果
             setTimeout(() => {
                 initWorkbenchEffects();
                 initTutorialEffects();
                 initPracticesEffects();
             }, ANIMATION_CONFIG.resizeDelay);
         });
         
         // 页面交互逻辑
         const btnSend = document.querySelector('.btn-send');
         if (btnSend) {
             btnSend.addEventListener('click', function() {
                 const textarea = document.getElementById('mainTextarea');
                 // 如果是contenteditable div，需要获取文本内容
                 let text = '';
                 if (textarea.contentEditable === 'true') {
                     const walker = document.createTreeWalker(
                         textarea,
                         NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,
                         {
                             acceptNode: function(node) {
                                 if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('mention-tag')) {
                                     return NodeFilter.FILTER_ACCEPT;
                                 }
                                 if (node.nodeType === Node.TEXT_NODE) {
                                     return NodeFilter.FILTER_ACCEPT;
                                 }
                                 return NodeFilter.FILTER_SKIP;
                             }
                         }
                     );
                     
                     let node;
                     while (node = walker.nextNode()) {
                         if (node.nodeType === Node.TEXT_NODE) {
                             text += node.textContent;
                         } else if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('mention-tag')) {
                             const bomName = node.dataset.bomName;
                             const version = node.dataset.version;
                             text += `@${bomName}(${version})`;
                         }
                     }
                 } else {
                     text = textarea.value;
                 }
                 console.log('发送消息:', text);
             });
         }
         
         // @提及功能
         (function() {
             const textarea = document.getElementById('mainTextarea');
             const dropdown = document.getElementById('mentionDropdown');
             const searchWrapper = textarea.closest('.search-wrapper');
             
             // BOM档案数据（树形结构）
             const bomData = [
                 {
                     name: '电源切换模块BOM',
                     versions: [
                         { version: 'v1.0', date: '2024-01-15' },
                         { version: 'v2.0', date: '2024-03-20' },
                         { version: 'v2.1', date: '2024-05-10' }
                     ]
                 },
                 {
                     name: '新电源芯片mos选型',
                     versions: [
                         { version: 'v1.0', date: '2024-02-01' },
                         { version: 'v1.5', date: '2024-04-12' }
                     ]
                 },
                 {
                     name: '60V参数的mos查询',
                     versions: [
                         { version: 'v1.0', date: '2024-01-20' },
                         { version: 'v1.2', date: '2024-03-05' },
                         { version: 'v2.0', date: '2024-06-18' }
                     ]
                 },
                 {
                     name: 'BOM更新需求分析',
                     versions: [
                         { version: 'v1.0', date: '2024-02-15' }
                     ]
                 },
                 {
                     name: 'BOM中mos替换分析',
                     versions: [
                         { version: 'v1.0', date: '2024-03-10' },
                         { version: 'v1.1', date: '2024-04-25' }
                     ]
                 },
                 {
                     name: 'R26系列同规格产品推荐',
                     versions: [
                         { version: 'v1.0', date: '2024-04-01' },
                         { version: 'v1.3', date: '2024-05-20' },
                         { version: 'v2.0', date: '2024-07-01' }
                     ]
                 }
             ];
             
             let selectedIndex = 0;
             let mentionStartNode = null;
             let mentionStartOffset = -1;
             let savedRange = null; // 保存当前的range
             
             // 渲染下拉菜单
             function renderDropdown() {
                 dropdown.innerHTML = '';
                 
                 bomData.forEach((bom, bomIndex) => {
                     // BOM名称组（可展开/折叠）
                     const groupItem = document.createElement('div');
                     groupItem.className = 'mention-item-group expanded';
                     
                     const groupIcon = document.createElement('span');
                     groupIcon.className = 'mention-group-icon';
                     groupIcon.innerHTML = '▶';
                     
                     const folderIcon = document.createElement('span');
                     folderIcon.className = 'folder-icon';
                     folderIcon.innerHTML = '📁';
                     
                     const groupText = document.createElement('span');
                     groupText.textContent = bom.name;
                     
                     groupItem.appendChild(groupIcon);
                     groupItem.appendChild(folderIcon);
                     groupItem.appendChild(groupText);
                     
                     // 点击组标题展开/折叠
                     groupItem.addEventListener('click', function(e) {
                         e.stopPropagation();
                         this.classList.toggle('expanded');
                     });
                     
                     dropdown.appendChild(groupItem);
                     
                     // 版本列表容器
                     const itemList = document.createElement('div');
                     itemList.className = 'mention-item-list';
                     
                     // 版本列表
                     bom.versions.forEach((version, versionIndex) => {
                         const item = document.createElement('div');
                         item.className = 'mention-item';
                         item.dataset.bomName = bom.name;
                         item.dataset.version = version.version;
                         
                         const icon = document.createElement('span');
                         icon.className = 'mention-item-icon';
                         icon.innerHTML = '▶';
                         
                         const text = document.createElement('span');
                         text.className = 'mention-item-text';
                         text.textContent = version.version;
                         
                         item.appendChild(icon);
                         item.appendChild(text);
                         itemList.appendChild(item);
                         
                         // 点击选择
                         item.addEventListener('mousedown', function(e) {
                             e.preventDefault();
                             e.stopPropagation();
                             
                             // 在mousedown时保存selection，防止点击时丢失
                             const selection = window.getSelection();
                             if (selection.rangeCount > 0) {
                                 savedRange = selection.getRangeAt(0).cloneRange();
                             }
                             
                             selectMention(bom.name, version.version);
                         });
                     });
                     
                     dropdown.appendChild(itemList);
                 });
                 
                 updateSelected();
             }
             
             // 更新选中状态
             function updateSelected() {
                 // 只获取可见的项（展开的组下的项）
                 const visibleItems = Array.from(dropdown.querySelectorAll('.mention-item')).filter(item => {
                     return item.offsetParent !== null; // 检查是否可见
                 });
                 
                 visibleItems.forEach((item, index) => {
                     item.classList.toggle('selected', index === selectedIndex);
                 });
                 
                 // 滚动到选中项
                 const selectedItem = visibleItems[selectedIndex];
                 if (selectedItem) {
                     selectedItem.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                 }
             }
             
             // 获取可见项列表
             function getVisibleItems() {
                 return Array.from(dropdown.querySelectorAll('.mention-item')).filter(item => {
                     return item.offsetParent !== null;
                 });
             }
             
             // 选择提及项
             function selectMention(bomName, version) {
                 const selection = window.getSelection();
                 
                 if (!mentionStartNode) {
                     console.log('selectMention: missing mentionStartNode');
                     return;
                 }
                 
                 // 如果没有selection，使用保存的range
                 let range;
                 if (selection.rangeCount > 0) {
                     range = selection.getRangeAt(0);
                 } else if (savedRange) {
                     range = savedRange;
                     selection.addRange(savedRange.cloneRange());
                 } else {
                     console.log('selectMention: no range available');
                     return;
                 }
                 
                 try {
                     
                     // 创建@提及标签
                     const mentionTag = document.createElement('span');
                     mentionTag.className = 'mention-tag';
                     mentionTag.contentEditable = 'false';
                     mentionTag.dataset.bomName = bomName;
                     mentionTag.dataset.version = version;
                     
                     const icon = document.createElement('span');
                     icon.className = 'mention-tag-icon';
                     icon.textContent = 'B';
                     
                     const text = document.createElement('span');
                     text.className = 'mention-tag-text';
                     text.textContent = `${bomName}(${version})`;
                     
                     mentionTag.appendChild(icon);
                     mentionTag.appendChild(text);
                     
                     // 创建删除范围：从@符号到光标位置
                     const deleteRange = document.createRange();
                     
                     // 确保节点仍然存在
                     if (!mentionStartNode.parentNode) {
                         console.log('selectMention: mentionStartNode no longer exists');
                         hideDropdown();
                         return;
                     }
                     
                     deleteRange.setStart(mentionStartNode, mentionStartOffset);
                     deleteRange.setEnd(range.startContainer, range.startOffset);
                     
                     // 删除@符号及其后的内容
                     deleteRange.deleteContents();
                     
                     // 在删除位置插入标签
                     deleteRange.insertNode(mentionTag);
                     
                     // 创建空格文本节点
                     const textNode = document.createTextNode(' ');
                     
                     // 在标签后插入空格
                     const insertRange = document.createRange();
                     insertRange.setStartAfter(mentionTag);
                     insertRange.collapse(true);
                     insertRange.insertNode(textNode);
                     
                     // 设置光标到空格后
                     insertRange.setStartAfter(textNode);
                     insertRange.collapse(true);
                     
                     selection.removeAllRanges();
                     selection.addRange(insertRange);
                     
                     hideDropdown();
                     textarea.focus();
                 } catch (error) {
                     console.error('selectMention error:', error);
                     hideDropdown();
                 }
             }
             
             // 显示下拉菜单
             function showDropdown() {
                 // 确保弹窗在body下
                 if (dropdown.parentNode !== document.body) {
                     document.body.appendChild(dropdown);
                 }
                 
                 dropdown.classList.add('show');
                 selectedIndex = 0;
                 updateSelected();
                 
                 // 动态计算位置（使用fixed定位）
                 const rect = textarea.getBoundingClientRect();
                 dropdown.style.left = rect.left + 'px';
                 dropdown.style.top = (rect.top - dropdown.offsetHeight - 8) + 'px';
                 dropdown.style.width = Math.max(rect.width, 240) + 'px';
             }
             
             // 隐藏下拉菜单
             function hideDropdown() {
                 dropdown.classList.remove('show');
                 mentionStartNode = null;
                 mentionStartOffset = -1;
                 selectedIndex = 0;
                 savedRange = null;
             }
             
             // 检测@符号
             function checkMention(e) {
                 const selection = window.getSelection();
                 if (selection.rangeCount === 0) {
                     hideDropdown();
                     return;
                 }
                 
                 const range = selection.getRangeAt(0);
                 let textNode = range.startContainer;
                 let cursorPos = range.startOffset;
                 
                 // 如果光标在元素节点内，查找最近的文本节点
                 if (textNode.nodeType !== Node.TEXT_NODE) {
                     // 检查是否在@提及标签内
                     if (textNode.nodeType === Node.ELEMENT_NODE && textNode.classList.contains('mention-tag')) {
                         hideDropdown();
                         return;
                     }
                     
                     // 尝试找到文本节点
                     if (textNode.childNodes.length > 0 && cursorPos < textNode.childNodes.length) {
                         const childNode = textNode.childNodes[cursorPos];
                         if (childNode && childNode.nodeType === Node.TEXT_NODE) {
                             textNode = childNode;
                             cursorPos = 0;
                         } else {
                             hideDropdown();
                             return;
                         }
                     } else {
                         hideDropdown();
                         return;
                     }
                 }
                 
                 const text = textNode.textContent;
                 
                 // 查找光标前的@符号
                 let startPos = cursorPos - 1;
                 while (startPos >= 0 && text[startPos] !== '@' && text[startPos] !== ' ' && text[startPos] !== '\n') {
                     startPos--;
                 }
                 
                 if (startPos >= 0 && text[startPos] === '@') {
                     const afterAt = text.substring(startPos + 1, cursorPos);
                     
                     // 检查@后是否有空格或换行（如果有，说明@已经完成）
                     if (afterAt.includes(' ') || afterAt.includes('\n') || afterAt.includes('(')) {
                         hideDropdown();
                         return;
                     }
                     
                     // 保存@符号的位置
                     mentionStartNode = textNode;
                     mentionStartOffset = startPos;
                     
                     // 保存当前的range
                     const currentRange = range.cloneRange();
                     savedRange = currentRange;
                     
                     showDropdown();
                 } else {
                     hideDropdown();
                 }
             }
             
             // 获取编辑器文本内容（用于发送）
             function getEditorText() {
                 let text = '';
                 const walker = document.createTreeWalker(
                     textarea,
                     NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,
                     {
                         acceptNode: function(node) {
                             if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('mention-tag')) {
                                 return NodeFilter.FILTER_ACCEPT;
                             }
                             if (node.nodeType === Node.TEXT_NODE) {
                                 return NodeFilter.FILTER_ACCEPT;
                             }
                             return NodeFilter.FILTER_SKIP;
                         }
                     }
                 );
                 
                 let node;
                 while (node = walker.nextNode()) {
                     if (node.nodeType === Node.TEXT_NODE) {
                         text += node.textContent;
                     } else if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('mention-tag')) {
                         const bomName = node.dataset.bomName;
                         const version = node.dataset.version;
                         text += `@${bomName}(${version})`;
                     }
                 }
                 
                 return text;
             }
             
            // 清理空内容，确保placeholder能正确显示
            function cleanupEmptyContent() {
                // 获取纯文本内容（不包括@提及标签的文本）
                const text = textarea.textContent || textarea.innerText || '';
                // 如果内容为空，清理所有节点，确保div真正为空
                if (!text || text.trim() === '') {
                    textarea.innerHTML = '';
                }
            }
            
            // 监听输入事件
            textarea.addEventListener('input', function() {
                cleanupEmptyContent();
                checkMention();
            });
            textarea.addEventListener('keyup', function() {
                cleanupEmptyContent();
                checkMention();
            });
             
             // 防止删除@提及标签
             textarea.addEventListener('keydown', function(e) {
                 const selection = window.getSelection();
                 if (selection.rangeCount === 0) return;
                 
                 const range = selection.getRangeAt(0);
                 const startNode = range.startContainer;
                 
                // 如果光标在@提及标签内，阻止删除
                if (startNode.parentElement && startNode.parentElement.classList.contains('mention-tag')) {
                    if (e.key === 'Backspace' || e.key === 'Delete') {
                        e.preventDefault();
                        // 删除整个标签
                        const tag = startNode.parentElement;
                        tag.remove();
                        // 清理空内容，确保placeholder能正确显示
                        cleanupEmptyContent();
                        // 设置光标位置
                        const newRange = document.createRange();
                        if (textarea.firstChild) {
                            newRange.setStart(textarea.firstChild, 0);
                        } else {
                            newRange.setStart(textarea, 0);
                        }
                        newRange.collapse(true);
                        selection.removeAllRanges();
                        selection.addRange(newRange);
                    }
                }
             });
             
             // 键盘导航
             textarea.addEventListener('keydown', function(e) {
                 if (!dropdown.classList.contains('show')) return;
                 
                 const visibleItems = getVisibleItems();
                 
                 if (e.key === 'ArrowDown') {
                     e.preventDefault();
                     selectedIndex = Math.min(selectedIndex + 1, visibleItems.length - 1);
                     updateSelected();
                 } else if (e.key === 'ArrowUp') {
                     e.preventDefault();
                     selectedIndex = Math.max(selectedIndex - 1, 0);
                     updateSelected();
                 } else if (e.key === 'Enter' && visibleItems.length > 0) {
                     e.preventDefault();
                     const selectedItem = visibleItems[selectedIndex];
                     if (selectedItem) {
                         selectMention(selectedItem.dataset.bomName, selectedItem.dataset.version);
                     }
                 } else if (e.key === 'Escape') {
                     e.preventDefault();
                     hideDropdown();
                 }
             });
             
             // 点击外部关闭
             document.addEventListener('click', function(e) {
                 if (!searchWrapper.contains(e.target) && !dropdown.contains(e.target)) {
                     hideDropdown();
                 }
             });
             
             // 初始化渲染
             renderDropdown();
         })();
         
         // 菜单项点击事件
         document.getElementById('newProject')?.addEventListener('click', function() {
             console.log('新建会话');
         });
         
         document.getElementById('bomArchive')?.addEventListener('click', function() {
             console.log('BOM档案');
         });
         
         document.getElementById('knowledgeBase')?.addEventListener('click', function() {
             console.log('知识库');
         });
         
         // 搜索框快捷键
         const searchInput = document.getElementById('searchInput');
         if (searchInput) {
             document.addEventListener('keydown', function(e) {
                 // ⌘ + K 或 Ctrl + K
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
            });
        }
        
        // 处理会话项的气泡菜单
        document.addEventListener('DOMContentLoaded', function() {
            const projectItems = document.querySelectorAll('.project-item');
            let currentOpenMenu = null;
            
            // 计算并设置菜单位置
            function setMenuPosition(menu, item) {
                const itemRect = item.getBoundingClientRect();
                const menuWidth = 120; // 菜单宽度
                const menuHeight = 80; // 估算菜单高度
                
                // 计算位置：在项目项的右侧，垂直居中
                const left = itemRect.right - menuWidth - 8;
                const top = itemRect.top + (itemRect.height / 2) - (menuHeight / 2);
                
                menu.style.left = left + 'px';
                menu.style.top = top + 'px';
            }
            
            projectItems.forEach(function(item) {
                const moreBtn = item.querySelector('.project-item-more');
                const menu = item.querySelector('.project-item-menu');
                
                if (moreBtn && menu) {
                    // 点击三个点按钮，显示/隐藏菜单
                    moreBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        
                        // 如果当前菜单已打开，则关闭它
                        if (currentOpenMenu === menu) {
                            menu.classList.remove('show');
                            currentOpenMenu = null;
                        } else {
                            // 关闭其他已打开的菜单
                            if (currentOpenMenu) {
                                currentOpenMenu.classList.remove('show');
                            }
                            // 计算并设置位置
                            setMenuPosition(menu, item);
                            // 打开当前菜单
                            menu.classList.add('show');
                            currentOpenMenu = menu;
                        }
                    });
                }
            });
            
            // 点击页面其他地方时关闭菜单
            document.addEventListener('click', function(e) {
                if (currentOpenMenu && !currentOpenMenu.contains(e.target)) {
                    const moreBtn = currentOpenMenu.parentElement.querySelector('.project-item-more');
                    if (moreBtn && !moreBtn.contains(e.target)) {
                        currentOpenMenu.classList.remove('show');
                        currentOpenMenu = null;
                    }
                }
            });
            
            // 滚动时重新计算菜单位置
            const projectList = document.getElementById('projectList');
            if (projectList) {
                projectList.addEventListener('scroll', function() {
                    if (currentOpenMenu) {
                        const item = currentOpenMenu.parentElement;
                        setMenuPosition(currentOpenMenu, item);
                    }
                });
            }
        });
    </script>

    <!-- 研发偏好设置弹窗 -->
    <div class="settings-modal-overlay" id="indexSettingsModal">
        <div class="settings-modal">
            <div class="settings-modal-header">
                <h2 class="settings-modal-title">
                    <img src="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/f4f1acead1b2b1cfc74946089e643749.png" alt="硅宝" class="settings-modal-title-icon">
                    <span>研发偏好</span>
                </h2>
                <button class="settings-modal-close" id="indexSettingsClose">×</button>
            </div>
            <div class="settings-modal-content">
                <div class="settings-form-section">
                    <div class="settings-form-section-title">研发风格</div>
                    <div class="settings-tags-container">
                        <div class="settings-preference-tag selected" data-mode="balanced">
                            <span class="settings-preference-tag-icon">⚖️</span>
                            <span>均衡模式</span>
                            <div class="settings-preference-tag-tooltip">
                                在任务深度和时间上做了平衡，适用于大多数工程师
                            </div>
                        </div>
                        <div class="settings-preference-tag" data-mode="efficiency">
                            <span class="settings-preference-tag-icon">⚡</span>
                            <span>效率模式</span>
                            <div class="settings-preference-tag-tooltip">
                                硅宝将专注于执行你发出的指令，速度最快，但不会帮你思考过多内容
                            </div>
                        </div>
                        <div class="settings-preference-tag" data-mode="inspiration">
                            <span class="settings-preference-tag-icon">💡</span>
                            <span>启发模式</span>
                            <div class="settings-preference-tag-tooltip">
                                硅宝将使用更复杂的模型和更多的数据与你协作，结果更丰富和全面，但耗时更久
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-form-section">
                    <div class="settings-form-section-title">选型偏好</div>
                    <textarea 
                        class="settings-preference-textarea" 
                        id="indexSelectionPreference"
                        placeholder="描述你的选型倾向，例如：&#10;• 偏好的品牌（TI、ADI、国产等）&#10;• 技术参数要求（功耗、精度、速度等）&#10;• 应用场景特点（车规、工业、消费级）&#10;• 其他考虑因素"
                    ></textarea>
                </div>
            </div>
            <div class="settings-modal-footer">
                <button class="settings-btn settings-btn-cancel" id="indexSettingsCancel">取消</button>
                <button class="settings-btn settings-btn-save" id="indexSettingsSave">保存</button>
            </div>
        </div>
    </div>

    <script>
        // 研发偏好设置逻辑
        (function() {
            const modeConfig = {
                balanced: { icon: '⚖️', text: '均衡模式', class: 'balanced' },
                efficiency: { icon: '⚡', text: '效率模式', class: 'efficiency' },
                inspiration: { icon: '💡', text: '启发模式', class: 'inspiration' }
            };

            const modeBadge = document.getElementById('indexModeBadge');
            const modeBadgeText = document.getElementById('indexModeBadgeText');
            const settingsModal = document.getElementById('indexSettingsModal');
            const closeBtn = document.getElementById('indexSettingsClose');
            const cancelBtn = document.getElementById('indexSettingsCancel');
            const saveBtn = document.getElementById('indexSettingsSave');
            const preferenceTags = document.querySelectorAll('#indexSettingsModal .settings-preference-tag');
            const selectionPreference = document.getElementById('indexSelectionPreference');

            let selectedMode = 'balanced';

            function loadSettings() {
                const savedMode = localStorage.getItem('developmentMode');
                const savedPreference = localStorage.getItem('selectionPreference');

                if (savedMode && modeConfig[savedMode]) {
                    selectedMode = savedMode;
                    updateModeBadge(savedMode);
                    preferenceTags.forEach(tag => {
                        tag.classList.remove('selected');
                        if (tag.getAttribute('data-mode') === savedMode) {
                            tag.classList.add('selected');
                        }
                    });
                }

                if (savedPreference) {
                    selectionPreference.value = savedPreference;
                }
            }

            function updateModeBadge(mode) {
                const config = modeConfig[mode];
                modeBadge.className = `mode-badge ${config.class}`;
                modeBadge.querySelector('.mode-badge-icon').textContent = config.icon;
                modeBadgeText.textContent = config.text;
            }

            modeBadge.addEventListener('click', function() {
                settingsModal.classList.add('show');
            });

            function closeModal() {
                settingsModal.classList.remove('show');
            }

            closeBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);

            settingsModal.addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });

            document.querySelector('#indexSettingsModal .settings-modal').addEventListener('click', function(e) {
                e.stopPropagation();
            });

            preferenceTags.forEach(tag => {
                tag.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    if (selectedMode === mode) {
                        this.classList.remove('selected');
                        selectedMode = null;
                    } else {
                        preferenceTags.forEach(t => t.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedMode = mode;
                    }
                });
            });

            saveBtn.addEventListener('click', function() {
                const preference = selectionPreference.value.trim();
                if (selectedMode) {
                    localStorage.setItem('developmentMode', selectedMode);
                    updateModeBadge(selectedMode);
                } else {
                    localStorage.removeItem('developmentMode');
                }
                if (preference) {
                    localStorage.setItem('selectionPreference', preference);
                } else {
                    localStorage.removeItem('selectionPreference');
                }
                closeModal();
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && settingsModal.classList.contains('show')) {
                    closeModal();
                }
            });

            loadSettings();
        })();
    </script>
</body>
</html>